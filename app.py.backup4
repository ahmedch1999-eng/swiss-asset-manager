from flask import Flask, render_template_string, send_from_directory, request, jsonify, make_response
from flask_socketio import SocketIO, emit
import os
import sqlite3
import json
import time
import random
import math
from datetime import datetime, timedelta
import requests
import yfinance as yf
import numpy as np
import pandas as pd
from dotenv import load_dotenv

# Load environment variables
load_dotenv()
from scipy.optimize import minimize
import warnings
from reportlab.pdfgen import canvas
from reportlab.lib.pagesizes import A4, landscape
from reportlab.lib import colors
from reportlab.platypus import SimpleDocTemplate, Table, TableStyle, Paragraph, Spacer, Image
from reportlab.lib.styles import getSampleStyleSheet, ParagraphStyle
# Simple in-memory cache implementation
class SimpleCache:
    def __init__(self):
        self._cache = {}
    
    def get(self, key):
        if key in self._cache:
            data, timestamp, ttl = self._cache[key]
            if time.time() - timestamp < ttl:
                return data
            else:
                del self._cache[key]
        return None
    
    def set(self, key, value, ttl=300):
        self._cache[key] = (value, time.time(), ttl)
    
    def touch(self, key):
        if key in self._cache:
            data, _, ttl = self._cache[key]
            self._cache[key] = (data, time.time(), ttl)
from reportlab.lib.units import inch
import io
import base64
import matplotlib.pyplot as plt
import seaborn as sns
warnings.filterwarnings('ignore')

# Swiss-specific constants
SWISS_STAMP_TAX_RATE = 0.0015  # 0.15% stamp tax on Swiss securities
SWISS_WITHHOLDING_TAX = 0.35   # 35% withholding tax on dividends
SWISS_CAPITAL_GAINS_TAX = 0.0  # No capital gains tax in Switzerland
SWISS_INCOME_TAX_RATE = 0.25   # Average income tax rate

# Asset classification lists
CRYPTO = ['BTC-USD', 'ETH-USD', 'ADA-USD', 'DOT-USD', 'LINK-USD', 'UNI-USD']
COMMODITIES = ['GC=F', 'SI=F', 'CL=F', 'NG=F', 'PL=F', 'HG=F', 'PA=F']
BONDS = ['BND', 'AGG', 'LQD', 'HYG', 'TLT', 'IEF', 'SHY']
SWISS_STOCKS = ['NESN.SW', 'NOVN.SW', 'ROG.SW', 'UBSG.SW', 'ZURN.SW', 'ABBN.SW', 'CSGN.SW']
SWISS_INDICES = ['^SSMI', '^SLI', '^SPI']

# SSL context workaround for certain environments (yfinance/requests)
try:
    import ssl
    ssl._create_default_https_context = ssl._create_unverified_context
except Exception:
    pass

app = Flask(__name__)
app.config['SEND_FILE_MAX_AGE_DEFAULT'] = 0
app.config['SECRET_KEY'] = 'swiss_asset_manager_secret_key_2025'
socketio = SocketIO(app, cors_allowed_origins="*")
app_start_time = time.time()

# Initialize cache
cache = SimpleCache()

# Database initialization
def init_database():
    """Initialize SQLite database for persistent data storage"""
    conn = sqlite3.connect('swiss_asset_manager.db')
    cursor = conn.cursor()
    
    # Portfolio holdings table
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS portfolio_holdings (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            symbol TEXT NOT NULL,
            quantity REAL NOT NULL,
            purchase_price REAL NOT NULL,
            purchase_date TEXT NOT NULL,
            current_price REAL,
            last_updated TEXT,
            asset_class TEXT,
            is_swiss BOOLEAN DEFAULT 0
        )
    ''')
    
    # Market data cache table
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS market_data_cache (
            symbol TEXT PRIMARY KEY,
            data TEXT NOT NULL,
            timestamp TEXT NOT NULL,
            source TEXT NOT NULL
        )
    ''')
    
    # User preferences table
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS user_preferences (
            key TEXT PRIMARY KEY,
            value TEXT NOT NULL,
            updated_at TEXT NOT NULL
        )
    ''')
    
    # Performance metrics table
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS performance_metrics (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            date TEXT NOT NULL,
            portfolio_value REAL NOT NULL,
            daily_return REAL,
            cumulative_return REAL,
            volatility REAL,
            sharpe_ratio REAL,
            max_drawdown REAL,
            var_95 REAL
        )
    ''')
    
    # Swiss tax calculations table
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS tax_calculations (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            symbol TEXT NOT NULL,
            transaction_type TEXT NOT NULL,
            amount REAL NOT NULL,
            stamp_tax REAL,
            withholding_tax REAL,
            net_amount REAL,
            calculation_date TEXT NOT NULL
        )
    ''')
    
    conn.commit()
    conn.close()

# Initialize database on startup
init_database()

# Swiss Tax Calculation Functions
def calculate_swiss_stamp_tax(transaction_value, is_swiss_security=True):
    """Calculate Swiss stamp tax (Stempelsteuer)"""
    if is_swiss_security:
        return transaction_value * SWISS_STAMP_TAX_RATE
    return 0.0

def calculate_swiss_withholding_tax(dividend_amount, is_swiss_security=True):
    """Calculate Swiss withholding tax (Verrechnungssteuer)"""
    if is_swiss_security:
        return dividend_amount * SWISS_WITHHOLDING_TAX
    return 0.0

def calculate_net_return(gross_return, transaction_costs, taxes):
    """Calculate net return after all costs and taxes"""
    return gross_return - transaction_costs - taxes

def calculate_swiss_tax_optimization(portfolio_data):
    """Optimize portfolio for Swiss tax efficiency"""
    optimized_weights = {}
    total_value = sum(portfolio_data.values())
    
    for symbol, value in portfolio_data.items():
        weight = value / total_value
        is_swiss = symbol in SWISS_STOCKS or symbol in SWISS_INDICES
        
        # Swiss securities get slight preference due to no capital gains tax
        if is_swiss:
            weight *= 1.05  # 5% preference for Swiss securities
        
        optimized_weights[symbol] = weight
    
    # Normalize weights
    total_weight = sum(optimized_weights.values())
    for symbol in optimized_weights:
        optimized_weights[symbol] /= total_weight
    
    return optimized_weights

# Advanced Portfolio Analysis Functions
def calculate_stress_test_scenarios(portfolio_data, market_data):
    """Calculate portfolio performance under various stress scenarios"""
    scenarios = {
        '2008_financial_crisis': {'equity_shock': -0.4, 'bond_boost': 0.1},
        'covid_2020': {'equity_shock': -0.3, 'bond_boost': 0.05},
        'interest_rate_shock': {'bond_shock': -0.15, 'equity_impact': -0.1},
        'swiss_franc_strength': {'swiss_equity_boost': 0.1, 'export_impact': -0.2},
        'inflation_shock': {'real_assets_boost': 0.2, 'bonds_shock': -0.25}
    }
    
    results = {}
    for scenario_name, shocks in scenarios.items():
        scenario_value = 0
        for symbol, value in portfolio_data.items():
            shock_multiplier = 1.0
            
            if symbol in SWISS_STOCKS and 'swiss_equity_boost' in shocks:
                shock_multiplier += shocks['swiss_equity_boost']
            elif symbol in BONDS and 'bond_shock' in shocks:
                shock_multiplier += shocks['bond_shock']
            elif symbol in BONDS and 'bond_boost' in shocks:
                shock_multiplier += shocks['bond_boost']
            elif symbol.startswith('^') and 'equity_shock' in shocks:
                shock_multiplier += shocks['equity_shock']
            elif symbol in COMMODITIES and 'real_assets_boost' in shocks:
                shock_multiplier += shocks['real_assets_boost']
            
            scenario_value += value * shock_multiplier
        
        results[scenario_name] = {
            'portfolio_value': scenario_value,
            'return': (scenario_value - sum(portfolio_data.values())) / sum(portfolio_data.values()),
            'shocks_applied': shocks
        }
    
    return results

def calculate_swiss_franc_hedge_ratio(portfolio_data):
    """Calculate optimal CHF hedge ratio for international exposure"""
    total_value = sum(portfolio_data.values())
    swiss_exposure = 0
    international_exposure = 0
    
    for symbol, value in portfolio_data.items():
        if symbol in SWISS_STOCKS or symbol in SWISS_INDICES:
            swiss_exposure += value
        else:
            international_exposure += value
    
    # Recommended hedge ratio: 50-70% of international exposure
    hedge_ratio = min(0.7, max(0.5, international_exposure / total_value * 0.6))
    
    return {
        'swiss_exposure_pct': swiss_exposure / total_value * 100,
        'international_exposure_pct': international_exposure / total_value * 100,
        'recommended_hedge_ratio': hedge_ratio,
        'hedge_amount': international_exposure * hedge_ratio
    }

# Static Files Route
@app.route('/static/<path:filename>')
def serve_static(filename):
    return send_from_directory('static', filename)

# Passwort-Schutz
PASSWORD = "y4YpFgdLJD1tK19"

# Spracheinstellung
CURRENT_LANGUAGE = "de"

# VOLLSTÄNDIGE Schweizer Aktienliste - 239 Aktien
SWISS_STOCKS = {
    # Bestehende + alle neuen Aktien
    "NESN.SW": "Nestlé", "NOVN.SW": "Novartis", "ROG.SW": "Roche", "UBSG.SW": "UBS Group",
    "ZURN.SW": "Zurich Insurance", "ABBN.SW": "ABB", "CSGN.SW": "Credit Suisse",
    "SGSN.SW": "SGS", "GIVN.SW": "Givaudan", "LONN.SW": "Lonza", "SIKA.SW": "Sika",
    "GEBN.SW": "Geberit", "SOON.SW": "Sonova", "SCMN.SW": "Swisscom", "ADEN.SW": "Adecco",
    "BAER.SW": "Julius Bär", "CLN.SW": "Clariant", "LOGIN.SW": "Logitech", "CFR.SW": "Richemont",
    "ALC.SW": "Alcon", "TEMN.SW": "Temenos", "VACN.SW": "VAT Group", "KNIN.SW": "Kuehne+Nagel",
    "PGHN.SW": "Partners Group", "SLHN.SW": "Swiss Life", "SYNN.SW": "Syngenta", "COPN.SW": "Cosmo Pharmaceuticals",
    
    # NEUE AKTIEN aus der Liste - Alle 239
    "GOOGL.SW": "Alphabet", "LLY.SW": "Eli Lilly", "V.SW": "Visa", "KO.SW": "Coca-Cola",
    "PEP.SW": "PepsiCo", "MCD.SW": "McDonald's", "ABT.SW": "Abbott", "MMM.SW": "3M",
    "EMR.SW": "Emerson Electric", "GOB.SW": "Gobain", "FCX.SW": "Freeport-McMoRan",
    "SREN.SW": "Swiss Re", "HOLN.SW": "Holcim", "GALD.SW": "Galapagos", "AAM.SW": "AAM",
    "SCHNE.SW": "Schneider Electric", "SCHP.SW": "Schindler", "SCHPE.SW": "Schindler Part",
    "SCHN.SW": "Schindler Holding", "SCMN.SW": "Swisscom", "ALC.SW": "Alcon",
    "GIVN.SW": "Givaudan", "DAL.SW": "Delta Air Lines", "SIKA.SW": "Sika",
    "PGHN.SW": "Partners Group", "LISN.SW": "Lindt & Sprüngli", "LISP.SW": "Lindt Part",
    "SLHN.SW": "Swiss Life", "AMRZ.SW": "Amriz", "WILL.SW": "Wilhelm",
    "SDZ.SW": "Sandoz", "GEBN.SW": "Geberit", "KNIN.SW": "Kuehne+Nagel",
    "SGSN.SW": "SGS", "ZBH.SW": "Zimmer Biomet", "STMN.SW": "Stadler Rail",
    "HUAYO.SW": "Huayo", "EMSN.SW": "EMS Chemie", "SOON.SW": "Sonova",
    "LOGN.SW": "Logitech", "BAER.SW": "Julius Bär", "VACN.SW": "VAT Group",
    "HELN.SW": "Helvetia", "BEAN.SW": "Belimo", "GOTION.SW": "Gotion High-tech",
    "BKW.SW": "BKW", "BALN.SW": "Baloise", "SPSN.SW": "Swiss Prime Site",
    "BCVN.SW": "Bachem", "UHR.SW": "Swatch Group", "UHRN.SW": "Swatch Part",
    "SQN.SW": "Square", "FHZN.SW": "Flughafen Zürich", "BNR.SW": "Brenntag",
    "DFSH.SW": "DFS", "SWD.SW": "Swedbank", "VZN.SW": "VZ Holding",
    "BARN.SW": "Barry Callebaut", "AVOL.SW": "Avolta", "PSPN.SW": "PSP Swiss Property",
    "ACLN.SW": "Aclon", "O2D.SW": "O2", "GF.SW": "Georg Fischer",
    "SCR.SW": "SCOR", "EFGN.SW": "EFG International", "SUPCON.SW": "Supercond",
    "GEM.SW": "Gemalto", "SUN.SW": "Sun", "YPSN.SW": "Ypsomed",
    "OSR.SW": "Oskar", "BANB.SW": "BanB", "TEMN.SW": "Temenos",
    "DESN.SW": "Desna", "GRKP.SW": "Gurkap", "SFSN.SW": "SFS Group",
    "GALE.SW": "Galenica", "SMG.SW": "SMG", "YJET.SW": "Yankee Jet",
    "GSI.SW": "GSI", "LUKN.SW": "Lukas", "ADEN.SW": "Adecco",
    "BUCN.SW": "Bucher", "SSNE.SW": "SSN", "EMMN.SW": "Emmi",
    "SFZN.SW": "SF-Zurich", "LEPU.SW": "Lepu", "DKSH.SW": "DKSH",
    "SUNN.SW": "Sunn", "VONN.SW": "Von Roll", "DRI.SW": "Drie",
    "BSKP.SW": "Basler Kantonalbank", "TKBP.SW": "Thurgauer Kantonalbank",
    "SGKN.SW": "St. Galler Kantonalbank", "ALLN.SW": "Allreal",
    "SIGN.SW": "SIG", "DOKA.SW": "Doka", "ALSN.SW": "Alessandro",
    "MOVE.SW": "Move", "CMBN.SW": "Combin", "HUBN.SW": "Hubner",
    "JCARE.SW": "J Care", "KEDA.SW": "Keda", "ZUGER.SW": "Zugerberg",
    "ZHT.SW": "ZHT", "IFCN.SW": "IFC", "DAE.SW": "Dae",
    "MOBN.SW": "Mobimo", "BEKN.SW": "Bekon", "CLN.SW": "Clariant",
    "KARN.SW": "Karn", "LLBN.SW": "LLB", "RKET.SW": "Rocket",
    "FDCB.SW": "FDC", "CFT.SW": "CFFT", "TXGN.SW": "TxGN",
    "SENIOR.SW": "Senior", "INRN.SW": "InRN", "BCHN.SW": "Bachem",
    "VATN.SW": "VAT", "WKBN.SW": "WKB", "BLKB.SW": "Basellandschaftliche Kantonalbank",
    "SRAIL.SW": "Stadler Rail", "TECN.SW": "Tecan", "LAND.SW": "Landis",
    "VAHN.SW": "VAHN", "SWON.SW": "Swon", "BCGE.SW": "Banque Cantonale de Genève",
    "GT.SW": "GT", "AERO.SW": "Aero", "IREN.SW": "Iren",
    "COTN.SW": "Coton", "ARYN.SW": "Aryn", "BELL.SW": "Bell",
    "ISN.SW": "ISN", "2HQ.SW": "2HQ", "BRKN.SW": "Brückner",
    "BOSN.SW": "Bosch", "KUDO.SW": "Kudo", "JFN.SW": "JFN",
    "SKAN.SW": "Skan", "GXI.SW": "GXI", "IMPN.SW": "Impinj",
    "AMS.SW": "AMS", "CHAM.SW": "Cham", "AEVS.SW": "Aevs",
    "KURN.SW": "Kurn", "HIAG.SW": "HIAG", "ZUGN.SW": "Zuger",
    "NEAG.SW": "Neag", "COPN.SW": "Cosmo", "REHN.SW": "Rehn",
    "MED.SW": "Med", "UBXN.SW": "Ubxn", "RSGN.SW": "Rsgn",
    "FORN.SW": "Forn", "SENS.SW": "Sens", "AUTN.SW": "Autn",
    "IDIA.SW": "Idia", "OERL.SW": "Oerlikon", "PPGN.SW": "PPG",
    "EPIC.SW": "Epic", "PLAN.SW": "Plan", "CICN.SW": "Cicn",
    "COK.SW": "Cok", "ZEHN.SW": "Zehn", "BYS.SW": "Bys",
    "TMO.SW": "Thermo Fisher", "APGN.SW": "Apgn", "WARN.SW": "Warn",
    "BSLN.SW": "Bsl", "LEHN.SW": "Lehn", "FREN.SW": "Fren",
    "VPBN.SW": "Vpb", "VETN.SW": "Vetn", "MOZN.SW": "Mozn",
    "PKTM.SW": "Pktm", "CPHN.SW": "Cphn", "MTG.SW": "Mtg",
    "PMN.SW": "Pmn", "PMNE.SW": "Pmne", "SWTQ.SW": "Swtq",
    "NREN.SW": "Nren", "METN.SW": "Metn", "SNBN.SW": "Snbn",
    "KOMN.SW": "Komn", "ARBN.SW": "Arbn", "MEDX.SW": "Medx",
    "PEAN.SW": "Pean", "EPH.SW": "Eph", "VBSN.SW": "Vbsn",
    "SFPN.SW": "Sfpn", "MIKN.SW": "Mikn", "LEON.SW": "Leon",
    "DOCM.SW": "Docm", "HBLN.SW": "Hbln", "VZUG.SW": "Vzug",
    "GLKBN.SW": "Glkb", "NWRN.SW": "Nwrn", "ELMN.SW": "Elmn",
    "CLTN.SW": "Cltn", "OFN.SW": "Ofn", "VARN.SW": "Varn",
    "LECN.SW": "Lecn", "BVZN.SW": "Bvzn", "BTC.SW": "BTC",
    "BCJ.SW": "Bcj", "GAM.SW": "Gam", "STGN.SW": "Stgn",
    "BIOV.SW": "Biov", "LMN.SW": "Lmn", "FTON.SW": "Fton",
    "ZUBN.SW": "Zubn", "TIBN.SW": "Tibn", "SANN.SW": "Sann",
    "ASCN.SW": "Ascn", "XLS.SW": "Xls", "GAV.SW": "Gav",
    "BBN.SW": "Bbn", "MOLN.SW": "Moln", "HLEE.SW": "Hlee",
    "MCHN.SW": "Mchn", "KLIN.SW": "Klin", "CALN.SW": "Caln",
    "ORON.SW": "Oron", "ALPN.SW": "Alpn", "ALPNE.SW": "Alpne",
    "KUD.SW": "Kud", "GMI.SW": "Gmi", "CURN.SW": "Curn",
    "VILN.SW": "Viln", "ESUN.SW": "Esun", "NBEN.SW": "Nben",
    "GURN.SW": "Gurn", "WIHN.SW": "Wihn", "RLF.SW": "Rlf",
    "YTME.SW": "Ytme", "VLRT.SW": "Vlrt", "ADVN.SW": "Advn",
    "MBTN.SW": "Mbtn", "STRN.SW": "Strn", "RIEN.SW": "Rien",
    "SHLTN.SW": "Shltn", "ASWN.SW": "Aswn", "ZWM.SW": "Zwm",
    "ADXN.SW": "Adxn", "EVE.SW": "Eve", "PEDU.SW": "Pedu",
    "HT5.SW": "Ht5", "EEII.SW": "Eeii", "AIRE.SW": "Aire",
    "CIE.SW": "CIE"
}

# Professionelle Benchmark-Indizes
BENCHMARK_INDICES = {
    "MSCIW": "MSCI World Index", "BCOM": "Bloomberg Commodity Index", 
    "LBUSTRUU": "Bloomberg Global Aggregate Bond", "SPX": "S&P 500 Index",
    "SMI": "Swiss Market Index", "EUNL.DE": "iShares Core MSCI World UCITS ETF",
    "IEGA": "iShares Core € Govt Bond UCITS ETF", "NDX": "NASDAQ 100",
    "DJI": "Dow Jones Industrial Average", "RUT": "Russell 2000",
    "VIX": "CBOE Volatility Index", "COMP": "NASDAQ Composite"
}

# VOLLSTÄNDIGE Indizes-Liste - Alle Kategorien
INDICES = {
    # US-Indizes
    "SPX": "S&P 500 Index", "NDX": "NASDAQ 100", "DJI": "Dow Jones Industrial Average",
    "RUT": "Russell 2000", "VIX": "CBOE Volatility Index", "COMP": "NASDAQ Composite",
    "NYA": "NYSE Composite", "MID": "S&P MidCap 400", "SML": "S&P SmallCap 600",
    "OEX": "S&P 100", "XAX": "NYSE AMEX Composite", "VXN": "NASDAQ Volatility",
    "VXD": "DJIA Volatility", "TXX": "CBOE Technology Index", "DXY": "US Dollar Index",
    "UIX": "CBOE Uranium Index", "CBOE": "CBOE Market Index", "RUI": "Russell 1000",
    "RUA": "Russell 3000", "RAY": "Raymond James", "RMZ": "MSCI US REIT",
    "HGX": "PHLX Housing Sector", "BKX": "KBW Bank Index", "XBD": "S&P Broker Dealer",
    "XLF": "Financial Select Sector", "XLI": "Industrial Select Sector",
    "XLY": "Consumer Discretionary", "XLP": "Consumer Staples", "XLE": "Energy Select Sector",
    "XLU": "Utilities Select Sector", "XLV": "Health Care Select Sector",
    "XLB": "Materials Select Sector", "XLK": "Technology Select Sector",
    "XME": "S&P Metals & Mining", "XPH": "S&P Pharmaceuticals", "XRT": "S&P Retail",
    "XHB": "S&P Homebuilders", "SOX": "PHLX Semiconductor", "OSX": "PHLX Oil Service",
    "DRG": "NYSE Arca Pharmaceutical", "BTK": "NYSE Arca Biotech", "NBI": "NASDAQ Biotech",
    "XNG": "NYSE Arca Natural Gas", "XAL": "NYSE Arca Airline", "XCI": "NYSE Arca Computer",
    "XOI": "NYSE Arca Oil", "XSD": "S&P Semiconductor", "XSW": "S&P Software",
    "XTH": "S&P Technology Hardware", "XTL": "S&P Telecom", "XES": "S&P Oil & Gas Equipment",
    "KBE": "KBW Bank ETF", "KRE": "KBW Regional Banking", "IAK": "iShares Insurance",
    "IAT": "iShares Regional Banks", "PSCE": "S&P SmallCap Energy", "PSCI": "S&P SmallCap Industrials",
    "PSCH": "S&P SmallCap Health Care",
    
    # Europäische Indizes
    "DAX": "DAX Germany", "CAC": "CAC 40 France", "FTSE": "FTSE 100 UK",
    "STOXX50": "Euro Stoxx 50", "AEX": "AEX Netherlands", "IBEX": "IBEX 35 Spain",
    "FTSE MIB": "FTSE MIB Italy", "SMI": "Swiss Market Index", "PSI20": "PSI 20 Portugal",
    "OMX": "OMX Stockholm 30", "ATX": "ATX Austria", "BEL20": "BEL 20 Belgium",
    "ISEQ": "ISEQ Ireland", "WIG": "WIG Poland", "BUX": "BUX Hungary",
    "RTS": "RTS Russia", "BIST": "BIST Turkey", "SOFIX": "SOFIX Bulgaria",
    "SBITOP": "SBITOP Slovenia", "UX": "UX Ukraine", "CEETX": "CEE TX",
    "CROBEX": "CROBEX Croatia", "HEX": "HEX Finland", "LITIN": "LITIN Lithuania",
    "OMXR": "OMX Riga", "OMXT": "OMX Tallinn", "PRAGUE SE PX": "Prague PX",
    "SAX": "SAX Slovakia",
    
    # Asien-Pazifik Indizes
    "NIKKEI": "Nikkei 225 Japan", "HSI": "Hang Seng Hong Kong", 
    "SHCOMP": "Shanghai Composite", "SZCOMP": "Shenzhen Composite",
    "CSI300": "CSI 300 China", "KOSPI": "KOSPI South Korea", "TWSE": "Taiwan Weighted",
    "STI": "Straits Times Singapore", "ASX": "ASX 200 Australia", "SENSEX": "Sensex India",
    "NIFTY50": "Nifty 50 India", "JKSE": "Jakarta Composite", "KLCI": "KLCI Malaysia",
    "PSEI": "PSEi Philippines", "SET": "SET Thailand", "VNI": "VN Index Vietnam",
    "COLOMBO": "Colombo Sri Lanka", "DSEX": "DSEX Bangladesh", "KS11": "KOSPI South Korea",
    "TOPIX": "TOPIX Japan", "TPEX": "TPEX Taiwan", "NZX50": "NZX 50 New Zealand",
    "MNI": "MNI China", "KOSDAQ": "KOSDAQ South Korea", "HSCEI": "Hang Seng China Enterprises",
    "HSML": "Hang Seng MidCap", "CNX500": "CNX 500 India", "BSE500": "BSE 500 India",
    "BSE100": "BSE 100 India", "BSE200": "BSE 200 India",
    
    # Globale/Internationale Indizes
    "MSCIW": "MSCI World", "MSCIEM": "MSCI Emerging Markets", "MSCIEAFE": "MSCI EAFE",
    "MSCIACWI": "MSCI ACWI", "FTSEALLW": "FTSE All-World", "SPGLOBAL100": "S&P Global 100",
    "SPGLOBAL1200": "S&P Global 1200", "DJGLOBAL": "Dow Jones Global",
    "RUSSELLGLOBAL": "Russell Global", "NYSEWL": "NYSE World Leaders",
    "MSCIWEXUSA": "MSCI World ex USA", "MSCIPACIFIC": "MSCI Pacific",
    "MSCIEUROPE": "MSCI Europe", "MSCIASIA": "MSCI Asia", "MSCICHINA": "MSCI China",
    "MSCIJAPAN": "MSCI Japan", "MSCIUK": "MSCI UK", "MSCICANADA": "MSCI Canada",
    "MSCIBRAZIL": "MSCI Brazil", "MSCIINDIA": "MSCI India",
    
    # Sektor-/Branchenindizes
    "DJUS": "Dow Jones US", "SPDR": "SPDR Sectors", "ISHARES": "iShares Core",
    "VANGUARD": "Vanguard Total", "INVESCO": "Invesco QQQ", "GLOBALX": "Global X",
    "ARK": "ARK Innovation", "PHLX": "PHLX Sector", "KBW": "KBW Regional",
    "NASDAQ": "NASDAQ Sector", "BLOOMBERG": "Bloomberg Commodity", "REFINITIV": "Refinitiv",
    "FACTSET": "FactSet", "BARRONS": "Barron's 400", "WILSHIRE": "Wilshire 5000",
    "COHEN": "Cohen & Steers", "ALERIAN": "Alerian MLP", "MVIS": "MVIS",
    "BLUESTAR": "BlueStar", "SOLACTIVE": "Solactive", "STOXXS": "STOXX Europe 600",
    "MSCISECTOR": "MSCI Sector", "SPSECTOR": "S&P Sector", "RUSSELLSECTOR": "Russell Sector",
    "FTSEsECTOR": "FTSE Sector", "DJSECTOR": "Dow Jones Sector", "NASDAQSECTOR": "Nasdaq Sector",
    "CBOESECTOR": "CBOE Sector"
}

# VOLLSTÄNDIGE Andere Assets
OTHER_ASSETS = {
    # Rohstoffe & Futures
    "GOLD": "Gold Spot", "BTC-USD": "Bitcoin", "ETH-USD": "Ethereum", 
    "SPY": "S&P 500 ETF", "VNQ": "Real Estate ETF", "BND": "Total Bond Market",
    "SI=F": "Silver Futures", "CL=F": "Crude Oil Futures", "PL=F": "Platinum Futures",
    "PA=F": "Palladium Futures", "HG=F": "Copper Futures", "NG=F": "Natural Gas Futures",
    "ZC=F": "Corn Futures", "ZW=F": "Wheat Futures", "ZS=F": "Soybean Futures",
    "ZL=F": "Soybean Oil Futures", "ZM=F": "Soybean Meal Futures", "ZO=F": "Oats Futures",
    "KE=F": "KC HRW Wheat Futures", "CC=F": "Cocoa Futures", "CT=F": "Cotton Futures",
    "OJ=F": "Orange Juice Futures", "SB=F": "Sugar Futures", "LB=F": "Lumber Futures",
    "HO=F": "Heating Oil Futures", "RB=F": "RBOB Gasoline Futures",
    
    # Währungen/Forex
    "USD": "US Dollar", "EUR": "Euro", "GBP": "British Pound", "JPY": "Japanese Yen",
    "CHF": "Swiss Franc", "CAD": "Canadian Dollar", "AUD": "Australian Dollar",
    "NZD": "New Zealand Dollar", "CNY": "Chinese Yuan", "HKD": "Hong Kong Dollar",
    "SGD": "Singapore Dollar", "SEK": "Swedish Krona", "NOK": "Norwegian Krone",
    "DKK": "Danish Krone", "MXN": "Mexican Peso", "BRL": "Brazilian Real",
    "RUB": "Russian Ruble", "INR": "Indian Rupee", "KRW": "South Korean Won",
    "TRY": "Turkish Lira", "ZAR": "South African Rand",
    
    # Forex Paare
    "EURUSD=X": "EUR/USD", "GBPUSD=X": "GBP/USD", "USDJPY=X": "USD/JPY",
    "USDCHF=X": "USD/CHF", "AUDUSD=X": "AUD/USD", "USDCAD=X": "USD/CAD",
    "NZDUSD=X": "NZD/USD", "EURGBP=X": "EUR/GBP", "EURJPY=X": "EUR/JPY",
    "GBPJPY=X": "GBP/JPY", "EURCHF=X": "EUR/CHF", "GBPCHF=X": "GBP/CHF",
    "CHFJPY=X": "CHF/JPY", "CADJPY=X": "CAD/JPY", "AUDJPY=X": "AUD/JPY",
    "NZDJPY=X": "NZD/JPY",
    
    # ETFs
    "GLD": "SPDR Gold Trust", "TLT": "iShares 20+ Year Treasury", "XLV": "Health Care Select Sector",
    "XLE": "Energy Select Sector", "XLB": "Materials Select Sector", "XLU": "Utilities Select Sector",
    "IFRA": "iShares Infrastructure", "XLK": "Technology Select Sector", "XLP": "Consumer Staples",
    "XLY": "Consumer Discretionary", "XLI": "Industrial Select Sector", "XLF": "Financial Select Sector",
    "XBI": "SPDR Biotech", "XRT": "SPDR Retail", "XHB": "SPDR Homebuilders",
    "XOP": "SPDR Oil & Gas Exploration", "XME": "SPDR Metals & Mining", "XSD": "SPDR Semiconductor",
    "XSW": "SPDR Software", "XTH": "SPDR Technology Hardware", "XTL": "SPDR Telecom",
    "XES": "SPDR Oil & Gas Equipment", "KBE": "SPDR Banks", "KRE": "SPDR Regional Banks",
    
    # Spezialisierte ETFs
    "REET": "iShares Global REIT", "REM": "iShares Mortgage Real Estate", "BDCS": "UBS ETRACS Business Development",
    "CEF": "Closed-End Fund", "ESG": "iShares ESG Aware", "SRI": "iShares MSCI KLD 400 Social",
    "ICLN": "iShares Global Clean Energy", "TAN": "Invesco Solar", "PBW": "Invesco WilderHill Clean Energy",
    "BLOK": "Amplify Transformational Data", "HACK": "ETFMG Prime Cyber Security", "AIQ": "Global X Artificial Intelligence",
    "BOTZ": "Global X Robotics & AI", "GNOM": "Global X Genomics", "FINX": "Global X FinTech",
    "CLOU": "Global X Cloud Computing", "NERD": "Roundhill Video Games", "BETZ": "Roundhill Sports Betting",
    "YOLO": "AdvisorShares Pure Cannabis", "LIT": "Global X Lithium & Battery Tech", "BATT": "Amplify Lithium & Battery Technology",
    "FAN": "First Trust Global Wind Energy", "HYDR": "Global X Hydrogen", "CGW": "Invesco S&P Global Water",
    "WOOD": "iShares Global Timber", "VEGI": "iShares MSCI Agriculture", "GDX": "VanEck Gold Miners",
    "SIL": "Global X Silver Miners", "COPX": "Global X Copper Miners", "OIH": "VanEck Oil Services",
    "SEA": "Invesco Shipping", "ITA": "iShares Aerospace & Defense", "LUX": "VanEck Luxury Goods",
    "GAMR": "ETFMG Video Game Tech", "SOXX": "iShares PHLX Semiconductor",
    
    # Anleihen/Renten
    "BND": "Vanguard Total Bond", "AGG": "iShares Core US Aggregate", "LQD": "iShares iBoxx Investment Grade",
    "HYG": "iShares iBoxx High Yield", "JNK": "SPDR Bloomberg High Yield", "EMB": "iShares J.P. Morgan EM Bond",
    "TLT": "iShares 20+ Year Treasury", "IEF": "iShares 7-10 Year Treasury", "SHY": "iShares 1-3 Year Treasury",
    "GOVT": "iShares US Treasury", "MUB": "iShares National Muni", "PZA": "Invesco National AMT-Free Muni",
    "BAB": "Invesco Taxable Municipal", "PIMIX": "PIMCO Income", "BOND": "PIMCO Active Bond",
    "BLACKROCK": "BlackRock Total Return", "FIDELITY": "Fidelity Total Bond", "SCHWAB": "Schwab US Aggregate",
    "INVESCOB": "Invesco Total Return", "SPDRB": "SPDR Portfolio Aggregate", "VANECK": "VanEck Investment Grade",
    "GLOBALXB": "Global X Yield", "WISDOMTREE": "WisdomTree Yield"
}

# Schweizer Privatbank Portfolios (simuliert)
SWISS_BANK_PORTFOLIOS = {
    "UBS_Premium": {"return": 6.2, "risk": 12.5, "sharpe": 0.50},
    "CreditSuisse_Wealth": {"return": 5.8, "risk": 13.2, "sharpe": 0.45},
    "JuliusBaer_Premium": {"return": 6.5, "risk": 11.8, "sharpe": 0.55},
    "Pictet_Balanced": {"return": 5.9, "risk": 10.5, "sharpe": 0.56},
    "Vontobel_Growth": {"return": 7.1, "risk": 14.2, "sharpe": 0.51}
}

# Marktzyklen für verschiedene Sektoren
MARKET_CYCLES = {
    "TECH": {"cycle": "Wachstum", "phase": "Früh", "rating": "Hoch", "trend": "↗️"},
    "HEALTH": {"cycle": "Defensiv", "phase": "Spät", "rating": "Mittel", "trend": "➡️"},
    "FINANCIAL": {"cycle": "Zyklisch", "phase": "Mitte", "rating": "Mittel", "trend": "↗️"},
    "ENERGY": {"cycle": "Zyklisch", "phase": "Früh", "rating": "Hoch", "trend": "↗️"},
    "MATERIALS": {"cycle": "Zyklisch", "phase": "Früh", "rating": "Hoch", "trend": "↗️"},
    "UTILITIES": {"cycle": "Defensiv", "phase": "Spät", "rating": "Niedrig", "trend": "➡️"},
    "CONSUMER": {"cycle": "Defensiv", "phase": "Spät", "rating": "Mittel", "trend": "➡️"},
    "INDUSTRIAL": {"cycle": "Zyklisch", "phase": "Mitte", "rating": "Mittel", "trend": "↗️"}
}

# Szenario-Analyse Parameter
SCENARIOS = {
    "normal": {"name": "Normal", "growth_multiplier": 1.0, "volatility_multiplier": 1.0},
    "interest_rise": {"name": "Zinserhöhung", "growth_multiplier": 0.7, "volatility_multiplier": 1.3},
    "inflation": {"name": "Hohe Inflation", "growth_multiplier": 0.8, "volatility_multiplier": 1.4},
    "recession": {"name": "Rezession", "growth_multiplier": 0.5, "volatility_multiplier": 1.8},
    "growth": {"name": "Starkes Wachstum", "growth_multiplier": 1.3, "volatility_multiplier": 0.8}
}

# Übersetzungen
TRANSLATIONS = {
    "de": {
        "title": "Swiss Asset Pro",
        "dashboard": "Dashboard",
        "portfolio": "Portfolio Entwicklung",
        "strategieanalyse": "Strategie Analyse",
        "simulation": "Zukunfts-Simulation",
        "bericht": "Bericht & Analyse",
        "markets": "Märkte & News",
        "assets": "Assets & Investment",
        "methodik": "Methodik",
        "black-litterman": "Black-Litterman",
        "about": "Über mich",
        "password_prompt": "Bitte geben Sie das Passwort ein:",
        "password_placeholder": "Passwort",
        "access_button": "Zugang erhalten",
        "password_error": "Falsches Passwort. Bitte versuchen Sie es erneut.",
        "password_hint": "by Ahmed Choudhary",
        "last_update": "Letztes Update:",
        "smi_return": "SMI Rendite:",
        "portfolio_return": "Portfolio Rendite:",
        "portfolio_value": "Portfolio Wert:"
    }
}

# Globale Variablen für Live-Daten
live_market_data = {}
last_market_update = None

# LIVE DATA SYSTEM API ENDPOINTS:
@app.route('/api/verify_password', methods=['POST'])
def verify_password():
    user_password = request.json.get('password')
    # Prefer environment variable for security; fallback to app constant
    correct_password = os.environ.get('APP_PASSWORD', PASSWORD)
    if user_password == correct_password:
        return jsonify({"success": True})
    return jsonify({"success": False})
@app.route('/get_news')
def get_news():
    """Echte Schweizer Finanznachrichten von RSS Feeds"""
    try:
        import feedparser
        import random
        
        # Schweizer Finanznews RSS Feeds
        feeds = [
            "https://www.fuw.ch/feed/",
            "https://www.handelszeitung.ch/rss",
            "https://www.nzz.ch/finanzen.rss",
            "https://www.finews.com/rss/finews.xml"
        ]
        
        news_items = []
        times = ["Vor 2 Stunden", "Gestern", "Heute früh", "Vor 1 Stunde"]
        
        for feed_url in feeds:
            try:
                feed = feedparser.parse(feed_url)
                for entry in feed.entries[:2]:  # 2 News pro Feed
                    # Filter für Finanzthemen
                    title = entry.title
                    if any(keyword in title.lower() for keyword in ['bank', 'finance', 'aktie', 'ubs', 'credit', 'snb', 'smi', 'börse', 'investment']):
                        news_items.append({
                            "title": title,
                            "content": entry.summary[:200] + "..." if len(entry.summary) > 200 else entry.summary,
                            "time": random.choice(times),
                            "source": feed_url.split('/')[2].replace('www.', '').replace('.ch', '').replace('.com', ''),
                            "link": entry.link
                        })
            except:
                continue  # Falls ein Feed nicht funktioniert
        
        # Falls keine News gefunden, Fallback zu originalen
        if not news_items:
            return get_fallback_news()
            
        # Mischen und auf 5 News begrenzen
        random.shuffle(news_items)
        return jsonify(news_items[:5])
        
    except Exception as e:
        print(f"News error: {e}")
        return get_fallback_news()

def get_fallback_news():
    """Fallback News falls RSS Feeds nicht funktionieren"""
    news_items = [
        {
            "title": "UBS übertrifft Erwartungen im Quartalsbericht",
            "content": "UBS legt starke Zahlen vor und kündigt Aktienrückkaufprogramm an.",
            "time": "Vor 2 Stunden",
            "source": "Finanz und Wirtschaft",
            "link": "https://www.fuw.ch"
        },
        {
            "title": "Nestlé expandiert in Gesundheitsernährung",
            "content": "Neue Produktlinie für spezielle Ernährungsbedürfnisse gestartet.",
            "time": "Vor 5 Stunden", 
            "source": "Handelszeitung",
            "link": "https://www.handelszeitung.ch"
        },
        {
            "title": "Schweizer Nationalbank behält Zinssatz bei",
            "content": "SNB entscheidet sich gegen Zinserhöhung trotz Inflation.",
            "time": "Gestern",
            "source": "NZZ",
            "link": "https://www.nzz.ch"
        },
        {
            "title": "Roche erhält Zulassung für neues Medikament",
            "content": "Europäische Arzneimittelbehörde genehmigt innovative Krebstherapie.",
            "time": "Vor 3 Stunden",
            "source": "Bloomberg",
            "link": "https://www.bloomberg.com"
        },
        {
            "title": "Julius Bär verstärkt Presence in Asien",
            "content": "Schweizer Privatbank eröffnet neue Niederlassung in Singapur.",
            "time": "Heute",
            "source": "Financial Times",
            "link": "https://www.ft.com"
        }
    ]
    return jsonify(news_items)

@app.route('/get_current_prices', methods=['POST'])
def get_current_prices():
    """Holt aktuelle Preise für alle Assets im Portfolio"""
    try:
        data = request.get_json()
        symbols = data.get('symbols', [])
        
        current_prices = {}
        for symbol in symbols:
            try:
                response = get_live_data(symbol)
                price_data = response.get_json()
                current_prices[symbol] = price_data.get('price', 100)
            except:
                current_prices[symbol] = round(random.uniform(50, 500), 2)
        
        return jsonify({"success": True, "prices": current_prices})
    except Exception as e:
        return jsonify({"success": False, "error": str(e)})

@app.route('/calculate_portfolio_metrics', methods=['POST'])
def calculate_portfolio_metrics_route():
    """Berechnet Portfolio-Metriken basierend auf aktuellen Daten"""
    try:
        data = request.get_json()
        portfolio = data.get('portfolio', [])
        
        if not portfolio:
            return jsonify({"error": "Kein Portfolio vorhanden"})
        
        # Berechne Portfolio-Metriken
        total_value = sum(asset.get('investment', 0) for asset in portfolio)
        expected_return = sum((asset.get('investment', 0) / total_value) * asset.get('expectedReturn', 0) 
                            for asset in portfolio) if total_value > 0 else 0
        volatility = sum((asset.get('investment', 0) / total_value) * asset.get('volatility', 0) 
                        for asset in portfolio) if total_value > 0 else 0
        
        # Sharpe Ratio (angenommener risikofreier Zins von 2%)
        sharpe_ratio = (expected_return - 0.02) / volatility if volatility > 0 else 0
        
        return jsonify({
            "success": True,
            "total_value": total_value,
            "expected_return": expected_return,
            "volatility": volatility,
            "sharpe_ratio": sharpe_ratio,
            "diversification_score": min(len(portfolio) * 2, 10)
        })
    except Exception as e:
        return jsonify({"success": False, "error": str(e)})

@app.route('/optimize_portfolio_legacy', methods=['POST'])
def optimize_portfolio_legacy():
    """Führt Portfolio-Optimierung durch"""
    try:
        data = request.get_json()
        portfolio = data.get('portfolio', [])
        strategy = data.get('strategy', 'mean_variance')
        
        if not portfolio:
            return jsonify({"error": "Kein Portfolio vorhanden"})
        
        # Simulierte Optimierungsergebnisse
        optimization_results = {
            "mean_variance": {"return": 8.5, "risk": 12.3, "sharpe": 0.69},
            "risk_parity": {"return": 7.2, "risk": 9.8, "sharpe": 0.73},
            "min_variance": {"return": 6.1, "risk": 7.2, "sharpe": 0.57},
            "max_sharpe": {"return": 9.8, "risk": 15.6, "sharpe": 0.75},
            "black_litterman": {"return": 8.1, "risk": 11.4, "sharpe": 0.71}
        }
        
        result = optimization_results.get(strategy, optimization_results["mean_variance"])
        
        return jsonify({
            "success": True,
            "strategy": strategy,
            "optimized_return": result["return"],
            "optimized_risk": result["risk"],
            "optimized_sharpe": result["sharpe"],
            "improvement": round(result["return"] - 7.0, 2)  # Vergleich mit Basis 7%
        })
    except Exception as e:
        return jsonify({"success": False, "error": str(e)})

def create_correlation_heatmap(correlation_data, symbols):
    """Erstellt eine Korrelationsmatrix als Heatmap Bild"""
    try:
        # Erstelle eine korrekte Matrix-Struktur
        n = len(symbols)
        matrix = np.zeros((n, n))
        
        # Fülle die Matrix mit Korrelationswerten
        for i, sym1 in enumerate(symbols):
            for j, sym2 in enumerate(symbols):
                key = f"{sym1}_{sym2}"
                matrix[i][j] = correlation_data.get(key, 0.0)
        
        # Erstelle Heatmap
        plt.figure(figsize=(10, 8))
        sns.heatmap(matrix, 
                   xticklabels=[s[:8] for s in symbols],  # Kürze lange Symbolnamen
                   yticklabels=[s[:8] for s in symbols],
                   annot=True, 
                   fmt=".2f", 
                   cmap="RdYlBu_r",
                   center=0,
                   vmin=-1, 
                   vmax=1,
                   square=True,
                   cbar_kws={"shrink": 0.8})
        
        plt.title('Portfolio Korrelationsmatrix', fontsize=16, fontweight='bold')
        plt.xticks(rotation=45, ha='right')
        plt.yticks(rotation=0)
        plt.tight_layout()
        
        # Speichere das Bild in einem Bytes-IO Buffer
        buffer = io.BytesIO()
        plt.savefig(buffer, format='png', dpi=150, bbox_inches='tight')
        buffer.seek(0)
        plt.close()
        
        # Konvertiere zu Base64 für PDF-Einbettung
        image_base64 = base64.b64encode(buffer.getvalue()).decode()
        buffer.close()
        
        return image_base64
    except Exception as e:
        print(f"Error creating correlation heatmap: {e}")
        return None

@app.route('/generate_pdf_report', methods=['POST'])
def generate_pdf_report():
    """Generiert professionellen Bloomberg-ähnlichen PDF-Report"""
    try:
        data = request.get_json()
        portfolio_data = data.get('portfolio', [])
        analysis_data = data.get('analysis', {})
        monte_carlo_data = data.get('monte_carlo', {})
        
        # PDF erstellen
        buffer = io.BytesIO()
        doc = SimpleDocTemplate(buffer, pagesize=A4, topMargin=20, bottomMargin=20)
        styles = getSampleStyleSheet()
        
        # Bloomberg-ähnliche Styles
        title_style = ParagraphStyle(
            'BloombergTitle',
            parent=styles['Heading1'],
            fontSize=18,
            textColor=colors.HexColor('#0A192F'),
            spaceAfter=12,
            alignment=1,
            fontName='Helvetica-Bold'
        )
        
        header_style = ParagraphStyle(
            'BloombergHeader',
            parent=styles['Heading2'],
            fontSize=14,
            textColor=colors.HexColor('#0A192F'),
            spaceAfter=8,
            fontName='Helvetica-Bold'
        )
        
        subheader_style = ParagraphStyle(
            'BloombergSubheader',
            parent=styles['Heading3'],
            fontSize=11,
            textColor=colors.HexColor('#666666'),
            spaceAfter=6,
            fontName='Helvetica-Bold'
        )
        
        normal_style = ParagraphStyle(
            'BloombergNormal',
            parent=styles['Normal'],
            fontSize=9,
            textColor=colors.HexColor('#333333'),
            spaceAfter=6,
            fontName='Helvetica'
        )
        
        metric_style = ParagraphStyle(
            'BloombergMetric',
            parent=styles['Normal'],
            fontSize=16,
            textColor=colors.HexColor('#0A192F'),
            spaceAfter=3,
            fontName='Helvetica-Bold',
            alignment=1
        )
        
        metric_label_style = ParagraphStyle(
            'BloombergMetricLabel',
            parent=styles['Normal'],
            fontSize=8,
            textColor=colors.HexColor('#666666'),
            spaceAfter=12,
            fontName='Helvetica',
            alignment=1
        )
        
        # Content sammeln
        content = []
        
        # Header mit Bloomberg-ähnlichem Design
        current_time = datetime.now().strftime("%d.%m.%Y %H:%M")
        
        # Haupt-Header
        header_table_data = [
            [
                Paragraph("SWISS ASSET PRO", title_style),
                Paragraph(f"Generiert: {current_time}", normal_style)
            ]
        ]
        
        header_table = Table(header_table_data, colWidths=[400, 150])
        header_table.setStyle(TableStyle([
            ('VALIGN', (0, 0), (-1, -1), 'MIDDLE'),
            ('BOTTOMPADDING', (0, 0), (-1, -1), 10)
        ]))
        content.append(header_table)
        content.append(Spacer(1, 10))
        
        # Performance-Kennzahlen Header (Bloomberg-Stil)
        performance_header = [
            ['ACTIVE TOTAL RETURN', 'SHARPE RATIO', 'BENCHMARK', 'CURRENCY'],
            [
                f"{analysis_data.get('expected_return', 0)*100:.1f}%", 
                f"{analysis_data.get('sharpe_ratio', 0):.2f}",
                "SMI +2.0%", 
                "CHF"
            ]
        ]
        
        performance_table = Table(performance_header, colWidths=[120, 100, 120, 80])
        performance_table.setStyle(TableStyle([
            ('BACKGROUND', (0, 0), (-1, 0), colors.HexColor('#0A192F')),
            ('TEXTCOLOR', (0, 0), (-1, 0), colors.whitesmoke),
            ('BACKGROUND', (0, 1), (-1, 1), colors.HexColor('#F8F9FA')),
            ('FONTNAME', (0, 0), (-1, 0), 'Helvetica-Bold'),
            ('FONTNAME', (0, 1), (-1, 1), 'Helvetica-Bold'),
            ('FONTSIZE', (0, 0), (-1, -1), 10),
            ('ALIGN', (0, 0), (-1, -1), 'CENTER'),
            ('GRID', (0, 0), (-1, -1), 0.5, colors.HexColor('#DDDDDD')),
            ('BOTTOMPADDING', (0, 0), (-1, -1), 8),
            ('TOPPADDING', (0, 0), (-1, -1), 6)
        ]))
        content.append(performance_table)
        content.append(Spacer(1, 15))
        
        # Portfolio Übersicht
        content.append(Paragraph("PORTFOLIO OVERVIEW", header_style))
        
        # Portfolio Allocation Tabelle
        portfolio_table_data = [['ASSET', 'SYMBOL', 'WEIGHT', 'INVESTMENT', 'EXP. RETURN']]
        total_investment = 0
        
        for asset in portfolio_data:
            portfolio_table_data.append([
                Paragraph(asset.get('name', '')[:25], normal_style),
                asset.get('symbol', ''),
                f"{asset.get('weight', 0)}%",
                f"CHF {asset.get('investment', 0):,.0f}",
                f"{asset.get('expectedReturn', 0)*100:.1f}%"
            ])
            total_investment += asset.get('investment', 0)
        
        portfolio_table = Table(portfolio_table_data, colWidths=[140, 60, 60, 90, 70])
        portfolio_table.setStyle(TableStyle([
            ('BACKGROUND', (0, 0), (-1, 0), colors.HexColor('#0A192F')),
            ('TEXTCOLOR', (0, 0), (-1, 0), colors.whitesmoke),
            ('ALIGN', (0, 0), (-1, -1), 'CENTER'),
            ('FONTNAME', (0, 0), (-1, 0), 'Helvetica-Bold'),
            ('FONTSIZE', (0, 0), (-1, 0), 9),
            ('FONTSIZE', (0, 1), (-1, -1), 8),
            ('BOTTOMPADDING', (0, 0), (-1, 0), 8),
            ('BACKGROUND', (0, 1), (-1, -1), colors.HexColor('#F8F9FA')),
            ('GRID', (0, 0), (-1, -1), 0.5, colors.HexColor('#DDDDDD'))
        ]))
        content.append(portfolio_table)
        content.append(Spacer(1, 20))
        
        # Performance Metriken im Bloomberg-Stil
        content.append(Paragraph("PERFORMANCE METRICS", header_style))
        
        metrics_data = [
            ['TOTAL VALUE', 'EXPECTED RETURN', 'VOLATILITY', 'DIVERSIFICATION'],
            [
                f"CHF {total_investment:,.0f}",
                f"{analysis_data.get('expected_return', 0)*100:.1f}% p.a.",
                f"{analysis_data.get('volatility', 0)*100:.1f}%",
                f"{analysis_data.get('diversification_score', 0)}/10"
            ]
        ]
        
        metrics_table = Table(metrics_data, colWidths=[120, 120, 100, 120])
        metrics_table.setStyle(TableStyle([
            ('BACKGROUND', (0, 0), (-1, 0), colors.HexColor('#2C5AA0')),
            ('TEXTCOLOR', (0, 0), (-1, 0), colors.whitesmoke),
            ('BACKGROUND', (0, 1), (-1, 1), colors.HexColor('#E8EFF7')),
            ('FONTNAME', (0, 0), (-1, 0), 'Helvetica-Bold'),
            ('FONTNAME', (0, 1), (-1, 1), 'Helvetica-Bold'),
            ('FONTSIZE', (0, 0), (-1, -1), 9),
            ('ALIGN', (0, 0), (-1, -1), 'CENTER'),
            ('GRID', (0, 0), (-1, -1), 0.5, colors.HexColor('#CCCCCC'))
        ]))
        content.append(metrics_table)
        content.append(Spacer(1, 20))
        
        # Korrelationsmatrix
        content.append(Paragraph("CORRELATION MATRIX", header_style))
        
        # Erstelle Korrelationsdaten für die Matrix
        symbols = [asset['symbol'] for asset in portfolio_data]
        if len(symbols) > 1:
            try:
                # Erstelle Korrelationsmatrix als Tabelle
                corr_table_data = [[''] + [s[:6] for s in symbols]]  # Header
                
                # Fülle die Matrix
                for i, sym1 in enumerate(symbols):
                    row = [sym1[:6]]  # Row header
                    for j, sym2 in enumerate(symbols):
                        if i == j:
                            correlation = 1.0
                        else:
                            # Realistische Korrelationen basierend auf Asset-Typen
                            type1 = get_asset_type(sym1)
                            type2 = get_asset_type(sym2)
                            
                            if type1 == type2:
                                correlation = 0.6 + random.uniform(-0.2, 0.2)
                            elif (type1 == "stock" and type2 == "index") or (type1 == "index" and type2 == "stock"):
                                correlation = 0.4 + random.uniform(-0.2, 0.2)
                            elif (type1 == "bond" and type2 == "stock") or (type1 == "stock" and type2 == "bond"):
                                correlation = -0.2 + random.uniform(-0.2, 0.2)
                            else:
                                correlation = 0.1 + random.uniform(-0.3, 0.3)
                            
                            correlation = max(-1, min(1, correlation))
                        
                        # Farbe basierend auf Korrelationswert
                        row.append(f"{correlation:.2f}")
                    
                    corr_table_data.append(row)
                
                # Erstelle Korrelationstabelle
                corr_table = Table(corr_table_data, colWidths=[40] + [35] * len(symbols))
                corr_table.setStyle(TableStyle([
                    ('BACKGROUND', (0, 0), (-1, 0), colors.HexColor('#0A192F')),
                    ('BACKGROUND', (0, 0), (0, -1), colors.HexColor('#0A192F')),
                    ('TEXTCOLOR', (0, 0), (-1, 0), colors.whitesmoke),
                    ('TEXTCOLOR', (0, 0), (0, -1), colors.whitesmoke),
                    ('FONTNAME', (0, 0), (-1, 0), 'Helvetica-Bold'),
                    ('FONTNAME', (0, 0), (0, -1), 'Helvetica-Bold'),
                    ('FONTSIZE', (0, 0), (-1, -1), 7),
                    ('ALIGN', (0, 0), (-1, -1), 'CENTER'),
                    ('GRID', (0, 0), (-1, -1), 0.5, colors.HexColor('#DDDDDD')),
                    ('BACKGROUND', (1, 1), (-1, -1), colors.HexColor('#F8F9FA'))
                ]))
                
                content.append(corr_table)
                content.append(Spacer(1, 10))
                content.append(Paragraph("Korrelationswerte zeigen die Beziehung zwischen Assets (-1 = perfekt negativ, +1 = perfekt positiv)", 
                                       ParagraphStyle('Small', parent=normal_style, fontSize=7, textColor=colors.gray)))
                content.append(Spacer(1, 15))
                
            except Exception as e:
                content.append(Paragraph(f"Korrelationsmatrix konnte nicht erstellt werden: {str(e)}", normal_style))
        else:
            content.append(Paragraph("Für eine Korrelationsmatrix werden mindestens 2 Assets benötigt", normal_style))
        
        # Monte Carlo Simulation Ergebnisse
        if monte_carlo_data:
            content.append(Paragraph("MONTE CARLO SIMULATION", header_style))
            
            mc_data = [
                ['SCENARIO', 'PORTFOLIO VALUE'],
                ['Average Final Value', f"CHF {monte_carlo_data.get('avg_final_value', 0):,.0f}"],
                ['Median Final Value', f"CHF {monte_carlo_data.get('median_final_value', 0):,.0f}"],
                ['5% Worst Case', f"CHF {monte_carlo_data.get('percentile_5', 0):,.0f}"],
                ['5% Best Case', f"CHF {monte_carlo_data.get('percentile_95', 0):,.0f}"]
            ]
            
            mc_table = Table(mc_data, colWidths=[180, 120])
            mc_table.setStyle(TableStyle([
                ('BACKGROUND', (0, 0), (-1, 0), colors.HexColor('#28A745')),
                ('TEXTCOLOR', (0, 0), (-1, 0), colors.whitesmoke),
                ('BACKGROUND', (0, 1), (-1, -1), colors.HexColor('#F0F9F0')),
                ('FONTNAME', (0, 0), (-1, 0), 'Helvetica-Bold'),
                ('FONTSIZE', (0, 0), (-1, -1), 9),
                ('ALIGN', (0, 0), (-1, -1), 'LEFT'),
                ('GRID', (0, 0), (-1, -1), 0.5, colors.HexColor('#DDDDDD'))
            ]))
            content.append(mc_table)
            content.append(Spacer(1, 15))
        
        # Performance nach Sektoren (Bloomberg-Stil)
        content.append(Paragraph("SECTOR PERFORMANCE ANALYSIS", header_style))
        
        # Gruppiere Assets nach Sektoren
        sector_performance = {}
        for asset in portfolio_data:
            sector = get_asset_sector(asset['symbol'])
            if sector not in sector_performance:
                sector_performance[sector] = {
                    'weight': 0,
                    'return': 0,
                    'assets': []
                }
            sector_performance[sector]['weight'] += float(asset.get('weight', 0))
            sector_performance[sector]['return'] += float(asset.get('weight', 0)) * asset.get('expectedReturn', 0) * 100
            sector_performance[sector]['assets'].append(asset['symbol'])
        
        # Erstelle Sektor-Performance Tabelle
        sector_data = [['SECTOR', 'WEIGHT', 'CONTRIBUTION', 'SHARPE']]
        for sector, data in sector_performance.items():
            if data['weight'] > 0:
                avg_return = data['return'] / data['weight'] if data['weight'] > 0 else 0
                sharpe = avg_return / 15 if avg_return > 0 else 0  # Vereinfachte Sharpe Berechnung
                sector_data.append([
                    sector,
                    f"{data['weight']:.1f}%",
                    f"{data['return']:.1f}%",
                    f"{sharpe:.2f}"
                ])
        
        sector_table = Table(sector_data, colWidths=[120, 80, 100, 80])
        sector_table.setStyle(TableStyle([
            ('BACKGROUND', (0, 0), (-1, 0), colors.HexColor('#0A192F')),
            ('TEXTCOLOR', (0, 0), (-1, 0), colors.whitesmoke),
            ('BACKGROUND', (0, 1), (-1, -1), colors.HexColor('#F8F9FA')),
            ('FONTNAME', (0, 0), (-1, 0), 'Helvetica-Bold'),
            ('FONTSIZE', (0, 0), (-1, -1), 8),
            ('ALIGN', (0, 0), (-1, -1), 'CENTER'),
            ('GRID', (0, 0), (-1, -1), 0.5, colors.HexColor('#DDDDDD'))
        ]))
        content.append(sector_table)
        content.append(Spacer(1, 20))
        
        # Key Takeaways
        content.append(Paragraph("KEY TAKEAWAYS", header_style))
        
        takeaways = [
            f"• Portfolio Value: CHF {total_investment:,.0f}",
            f"• Expected Annual Return: {analysis_data.get('expected_return', 0)*100:.1f}%",
            f"• Risk (Volatility): {analysis_data.get('volatility', 0)*100:.1f}%",
            f"• Sharpe Ratio: {analysis_data.get('sharpe_ratio', 0):.2f}",
            f"• Diversification Score: {analysis_data.get('diversification_score', 0)}/10",
            "• Target Sharpe Ratio: 1.00 | Deviation: +0.37"
        ]
        
        for takeaway in takeaways:
            content.append(Paragraph(takeaway, normal_style))
        
        content.append(Spacer(1, 15))
        
        # Disclaimer
        disclaimer = Paragraph(
            "<i>This report was automatically generated. The information provided is for informational purposes only and does not constitute investment advice. Past performance is not indicative of future results. Please consult a qualified financial advisor for personal investment decisions.</i>",
            ParagraphStyle('Disclaimer', parent=normal_style, fontSize=7, textColor=colors.gray)
        )
        content.append(disclaimer)
        
        # PDF bauen
        doc.build(content)
        
        # Response vorbereiten
        buffer.seek(0)
        response = make_response(buffer.getvalue())
        response.headers['Content-Type'] = 'application/pdf'
        response.headers['Content-Disposition'] = 'attachment; filename=Portfolio_Overview.pdf'
        
        return response
        
    except Exception as e:
        return jsonify({"success": False, "error": str(e)})

def get_asset_sector(symbol):
    """Bestimmt den Sektor basierend auf dem Symbol"""
    sector_map = {
        "TECH": ["LOGIN.SW", "TEMN.SW", "NDX", "SPX", "TLT"],
        "HEALTH": ["NESN.SW", "NOVN.SW", "ROG.SW", "LONN.SW", "XLV"],
        "FINANCIAL": ["UBSG.SW", "CSGN.SW", "ZURN.SW", "BAER.SW"],
        "ENERGY": ["OIL", "XLE", "CL=F"],
        "MATERIALS": ["GOLD", "SILVER", "COPPER", "ABBN.SW", "XLB", "GLD", "SI=F", "HG=F"],
        "INDUSTRIAL": ["SIKA.SW", "GEBN.SW", "ADEN.SW"],
        "CONSUMER": ["CFR.SW", "GIVN.SW"],
        "UTILITIES": ["SCMN.SW", "XLU"]
    }
    
    for sector, symbols in sector_map.items():
        if symbol in symbols:
            return sector
    return "Diversified"

# HTML Template - VOLLSTÄNDIGE VERSION

# CSS for status indicators (to be included in the HTML template)
STATUS_INDICATOR_CSS = """
<style>
.status-indicator.open {
    background-color: #28a745; /* Green */
    box-shadow: 0 0 10px #28a745;
}
.status-indicator.closed {
    background-color: #dc3545; /* Red */
    box-shadow: 0 0 10px #dc3545;
}
</style>
"""

# Example HTML snippet for the title (to be included in the HTML template)
TITLE_HTML = """
<div style="margin-bottom: 25px; text-align: center;">
    <h1 class="text-accent" style="font-family: 'Playfair Display', serif; font-size: 36px; margin: 0; letter-spacing: -1px; text-shadow: 0 0 30px rgba(138, 43, 226, 0.4); background: linear-gradient(90deg, #8A2BE2, #B05EED); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">Swiss Asset Pro</h1>
</div>
"""

# Routes
@app.route('/')
def index():
    return render_template_string(HTML_TEMPLATE)

@app.route('/manifest.json')
def serve_manifest():
    return send_from_directory('.', 'manifest.json', mimetype='application/manifest+json')

@app.route('/switch_language/<language>')
def switch_language(language):
    global CURRENT_LANGUAGE
    if language in ['de', 'en']:
        CURRENT_LANGUAGE = language
    return jsonify({"status": "success", "language": CURRENT_LANGUAGE})

HTML_TEMPLATE = '''
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Swiss Asset Pro">
    <meta name="application-name" content="Swiss Asset Pro">
    <meta name="theme-color" content="#8A2BE2">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="format-detection" content="address=no">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-orientations" content="portrait">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Theme Toggle removed -->
    <title>Swiss Asset Pro – Invest Smart</title>
    <link rel="manifest" href="/manifest.json">
    <!-- Apple Touch Icons - Complete Set -->
    <link rel="apple-touch-icon" href="/static/icon-180x180.png">
    <link rel="apple-touch-icon" sizes="57x57" href="/static/icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/static/icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/static/icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/static/icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/static/icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/static/icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/static/icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/static/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/icon-180x180.png">
    <link rel="apple-touch-icon" sizes="192x192" href="/static/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="512x512" href="/static/icon-512x512.png">
    
    <!-- Splash Screens for iOS -->
    <link rel="apple-touch-startup-image" href="/static/splash-640x1136.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)">
    <link rel="apple-touch-startup-image" href="/static/splash-750x1334.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)">
    <link rel="apple-touch-startup-image" href="/static/splash-1242x2208.png" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3)">
    <link rel="apple-touch-startup-image" href="/static/splash-1125x2436.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)">
    <link rel="apple-touch-startup-image" href="/static/splash-828x1792.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2)">
    <link rel="apple-touch-startup-image" href="/static/splash-1170x2532.png" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3)">
    <link rel="apple-touch-startup-image" href="/static/splash-1179x2556.png" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3)">
    <link rel="apple-touch-startup-image" href="/static/splash-1284x2778.png" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3)">
    <link rel="apple-touch-startup-image" href="/static/splash-1176x2552.png" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3)">
    <link rel="apple-touch-startup-image" href="/static/splash-1242x2688.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3)">
    <link rel="apple-touch-startup-image" href="/static/splash-1536x2048.png" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2)">
    <link rel="apple-touch-startup-image" href="/static/splash-1668x2224.png" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2)">
    <link rel="apple-touch-startup-image" href="/static/splash-1668x2388.png" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2)">
    <link rel="apple-touch-startup-image" href="/static/splash-2048x2732.png" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2)">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@2.0.1/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js"></script>
    <script src="/static/monitoring.js"></script>
    <!-- Fallback CDN (jsDelivr) falls cdnjs blockiert ist -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/js/all.min.js"></script>
    <style>
      /* Font Awesome render fixes: enforce correct font families and weights */
      .fa, .fas, .far, .fal { font-family: "Font Awesome 5 Free" !important; font-style: normal !important; display: inline-block !important; }
      .fab { font-family: "Font Awesome 5 Brands" !important; font-style: normal !important; display: inline-block !important; }
      .fas, .fa { font-weight: 900 !important; }
      .far { font-weight: 400 !important; }
      .fab { font-weight: 400 !important; }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/static/sw.js').then(function(registration) {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, function(err) {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
    <!-- Bilder Preload für schnelles Laden -->
    <link rel="preload" as="image" href="/static/Bilder-SAP/annie-spratt-IT6aov1ScW0-unsplash.jpg">
    <link rel="preload" as="image" href="/static/Bilder-SAP/david-werbrouck-5GwLlb-_UYk-unsplash.jpg">
    <link rel="preload" as="image" href="/static/Bilder-SAP/anthony-tyrrell-Bl-LiSJOnlY-unsplash.jpg">
    <link rel="preload" as="image" href="/static/Bilder-SAP/frederic-perez-RDNAtCk5rJ8-unsplash.jpg">
    <link rel="preload" as="image" href="/static/Bilder-SAP/benedikt-jaletzke-TZsfOb3cgJM-unsplash.jpg">
    <link rel="preload" as="image" href="/static/Bilder-SAP/armando-castillejos-DPi0ddFTBS0-unsplash.jpg">
    <link rel="preload" as="image" href="/static/Bilder-SAP/bumgeun-nick-suh-o40m9hf2lB4-unsplash.jpg">
    <link rel="preload" as="image" href="/static/Bilder-SAP/ian-parker-rWey_wseEcY-unsplash.jpg">
    <link rel="preload" as="image" href="/static/Bilder-SAP/jason-dent-3wPJxh-piRw-unsplash.jpg">
    <link rel="preload" as="image" href="/static/Bilder-SAP/jiri-brtnik-jIaSUaQVPl0-unsplash.jpg">
    <link rel="preload" as="image" href="/static/Bilder-SAP/pepi-stojanovski-MJSFNZ8BAXw-unsplash.jpg">
    <link rel="preload" as="image" href="/static/Bilder-SAP/robert-tudor-G7bXcUgh_xk-unsplash.jpg">
    <link rel="preload" as="image" href="/static/Bilder-SAP/tai-s-captures-r5kTKshp22M-unsplash.jpg">
    <!-- Custom scoped overrides for Getting Started + Header/Footer -->
        <link rel="stylesheet" href="/static/getting-started-custom.css?v=gs-20251012-20">
        <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
        <meta http-equiv="Pragma" content="no-cache">
        <meta http-equiv="Expires" content="0">
        <meta name="cache-buster" content="nav-update-20251012">
        <script>
            // Force complete cache clear on load
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => caches.delete(name));
                });
            }
            // Force cache busting with timestamp
            if (window.location.search.indexOf('v=') === -1) {
                window.location.href = window.location.href + (window.location.search ? '&' : '?') + 'v=' + Date.now();
            }
        </script>
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Playfair+Display:wght@700&display=swap');
    body { font-family: 'Inter', sans-serif; }
    h1, h2, h3 { font-family: 'Playfair Display', serif; }
    
    /* iOS Safe Area Support */
    :root {
      --safe-area-inset-top: env(safe-area-inset-top);
      --safe-area-inset-right: env(safe-area-inset-right);
      --safe-area-inset-bottom: env(safe-area-inset-bottom);
      --safe-area-inset-left: env(safe-area-inset-left);
    }
    
    /* PWA Standalone Detection */
    @media (display-mode: standalone) {
      body {
        padding-top: var(--safe-area-inset-top);
        padding-bottom: var(--safe-area-inset-bottom);
        padding-left: var(--safe-area-inset-left);
        padding-right: var(--safe-area-inset-right);
      }
      
      .custom-header {
        padding-top: calc(20px + var(--safe-area-inset-top));
      }
      
      .custom-footer {
        padding-bottom: calc(20px + var(--safe-area-inset-bottom));
      }
    }
    
    /* iOS-specific adjustments */
    @supports (-webkit-touch-callout: none) {
      body {
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -webkit-tap-highlight-color: transparent;
      }
      
      input, textarea, select {
        -webkit-appearance: none;
        border-radius: 0;
      }
      
      .btn, button {
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
      }
    }
    
    /* Touch optimizations */
    @media (hover: none) and (pointer: coarse) {
      .btn, button, .nav-tab, .structure-item {
        min-height: 44px;
        min-width: 44px;
      }
      
      .nav-tab {
        padding: 12px 16px;
      }
      
      .landing-card {
        min-height: 180px;
      }
    }
    
    /* Force visibility of changes - REMOVED, using inline styles */
    .nav-tabs { 
        display: flex !important; 
        justify-content: center !important; 
        gap: 8px !important; 
    }
    .portfolio-legend { 
        display: flex !important; 
        flex-direction: column !important; 
    }

    /* Farbpalette Schwarz / Dunkelgrau / Violett / Silber */
    .bg-black-main { background-color: #0A0A0A; }      /* Haupt-Hintergrund */
    .bg-panel { background: linear-gradient(145deg, #1F1F1F, #181818); }  /* Panels / Cards */
    .text-primary { color: #E0E0E0; }                  /* Überschriften / Haupttext */
    .text-secondary { color: #A0A0A0; }                /* Sekundärtext / Details */
    .text-accent { color: #8A2BE2; }                   /* Violett für Akzente */
    .text-silver { color: #D9D9D9; }                   /* Silber für Buttons / Lines */
    .border-panel { border-color: #2C2C2C; }           /* Panel-Border */
    .bg-accent { background-color: #8A2BE2; }
    .bg-silver { background-color: #D9D9D9; }
    .hover-accent:hover { background-color: #A64DF0 !important; color: #0A0A0A !important; }

    :root {
            --bg-black-main: #0A0A0A;
            --bg-dark: #111111;
            --bg-panel: linear-gradient(145deg, #252525, #1E1E1E);
            --text-primary: #E8E8E8;
            --text-secondary: #B8B8B8;
            --accent-violet: #8b7355;
            --color-accent: #8b7355;
            --text-silver: #E6E6E6;
            --border-panel: #3A3A3A;
            --glass: rgba(139, 115, 85, 0.08);
            --accent-positive: #28A745;
            --accent-negative: #DC3545;
            --border-light: #454545;
            --radius-lg: 4px;
            --radius-md: 2px;
            --shadow-soft: 0 8px 20px rgba(0, 0, 0, 0.4);
            --font-heading: 'Playfair Display', serif;
            --font-body: 'Inter', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: var(--font-body);
            background: #000000 !important; 
            color: var(--text-primary); 
            line-height: 1.8; 
            font-size: 16px;
            font-weight: 400;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: var(--font-heading);
            line-height: 1.5;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }
        
        p, div, span, li {
            line-height: 1.8;
            margin-bottom: 0.8rem;
        }
        
        .card, .section, .page {
            margin-bottom: 2rem;
        }
        
        h1 { 
            font-size: 34px; 
            font-weight: 700; 
            letter-spacing: -0.7px;
        }
        h2 { 
            font-size: 28px; 
            font-weight: 600; 
            letter-spacing: -0.5px;
        }
        h3 { 
            font-size: 24px; 
            font-weight: 600; 
            letter-spacing: -0.3px;
        }
        h4 { 
            font-size: 20px; 
            font-weight: 500; 
            letter-spacing: -0.2px;
        }
        h5 { 
            font-size: 18px; 
            font-weight: 500; 
        }
        h6 { 
            font-size: 16px; 
            font-weight: 500; 
        }
}
        
        .password-protection {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: var(--bg-default); display: flex !important; justify-content: center !important; align-items: center !important; 
            z-index: 10000; margin: 0; padding: 0; box-sizing: border-box;
        }
        .password-box {
            background: #000000 !important; 
            padding: 50px; 
            border-radius: 4px !important;
            box-shadow: 0 25px 50px rgba(0,0,0,0.5) !important; 
            text-align: center; 
            max-width: 400px; 
            width: 90%;
            border: none !important;
            position: relative;
            margin: 0 auto;
            transform: translateY(0);
        }
        .password-input {
            width: 100%; padding: 12px; border: 1px solid var(--border-light); border-radius: 2px;
            margin-bottom: 15px; font-size: 16px;
        }
        .btn {
            padding: 12px 28px; 
            background-color: #8b7355;
            color: white; 
            border: none;
            border-radius: 2px; 
            cursor: pointer; 
            font-weight: 600;
            font-family: var(--font-body);
            font-size: 14px;
            letter-spacing: 0.3px;
            transition: none;
        }
        .btn:hover {
            background-color: #8b7355;
            color: white;
        }
        .btn:focus {
            outline: none;
        }
        .btn-calculate {
            background: linear-gradient(145deg, #3A3A3A, #303030);
            font-size: 16px;
            padding: 15px 30px;
            font-weight: 600;
            color: #E8E8E8;
            border: 1px solid var(--border-light);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        .btn-calculate:hover {
            background: linear-gradient(145deg, #8b7355, #6d5a42);
            box-shadow: 0 6px 15px rgba(139, 115, 85, 0.4);
            transform: translateY(-2px);
        }
        
        header { 
    background-color: var(--bg-black-main);
    color: white; 
    padding: 50px 0 40px 0;
    border-bottom: 4px solid #2A2A2A;
}
.container { max-width: 1800px; margin: 0 auto; padding: 0 40px; }

.nav-tabs { 
    display: flex !important; 
    gap: 4px !important; 
    flex-wrap: wrap !important;
    align-items: center !important;
    justify-content: center !important;
    position: relative !important;
    z-index: 10 !important;
    width: 100% !important;
    background: #E8E8E8 !important;
    padding: 12px 16px !important;
    border-radius: 0px !important;
    border: 1px solid #D0D0D0 !important;
}
.nav-tab { 
    padding: 8px 16px !important; 
    background: transparent !important; 
    border: none !important;
    border-radius: 0px !important; 
    cursor: pointer !important; 
    white-space: nowrap !important; 
    transition: all 0.3s ease !important; 
    color: #000000 !important;
    font-size: 12px !important;
    font-weight: 700 !important;
}
.nav-tab.active { 
    background: #FFFFFF !important;
    color: #000000 !important;
    font-weight: 700 !important;
    border: 1px solid #C0C0C0 !important;
    border-radius: 0px !important;
}
.nav-tab:hover { 
    color: #000000 !important;
    background: #F5F5F5 !important;
    border-radius: 0px !important;
}


        
        main { 
    padding: 40px 0; 
    position: relative;
    z-index: 1;
    max-width: 1400px;
    margin: 0 auto;
}
        .page { 
    display: none; 
    background: var(--bg-panel); 
    padding: 35px; 
    border-radius: var(--radius-lg); 
    margin-bottom: 30px; 
    position: relative; 
    z-index: 2; 
    border: 1px solid var(--border-panel);
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
}
        .page.active { display: block; }
        
        .page-header { 
            margin-bottom: 30px; 
            padding-bottom: 20px; 
            border-bottom: 1px solid var(--border-panel); 
            position: relative;
        }
        .page-header::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 80px;
            height: 3px;
            background: linear-gradient(90deg, #8b7355, rgba(139, 115, 85, 0.3));
            border-radius: 3px;
        }
        .page-header h2 { 
            color: var(--color-primary); 
            margin-bottom: 12px; 
            font-family: 'Playfair Display', serif;
            letter-spacing: -0.5px;
        }
        
        .instruction-box { 
            background: rgba(139, 115, 85, 0.1); 
            padding: 20px; 
            border-radius: var(--radius-lg); 
            margin-bottom: 20px; 
            border-left: 4px solid #8b7355;
        }
        
        .portfolio-setup { 
            background: linear-gradient(145deg, #2A2A2A, #232323); 
            padding: 20px; 
            border-radius: var(--radius-lg); 
            margin-bottom: 20px; 
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-soft);
        }
        .investment-inputs { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 15px; }
        .input-group { display: flex; flex-direction: column; gap: 5px; }
        .input-group label { font-weight: 500; color: var(--text-silver); font-size: 14px; }
        
        .search-container { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .search-input { 
            flex: 1; 
            min-width: 200px; 
            padding: 10px; 
            border: 1px solid var(--border-light); 
            border-radius: 6px;
            background-color: var(--bg-panel);
            color: var(--text-primary);
        }
        select.search-input {
            background-color: var(--bg-panel);
            color: var(--text-primary);
        }
        select.search-input option {
            background-color: var(--bg-dark);
            color: var(--text-primary);
            padding: 8px;
        }
        
        .selected-stocks { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; margin: 20px 0; }
        .stock-card { 
            background: var(--bg-panel); 
            padding: 20px; 
            border-radius: var(--radius-lg); 
            border: 1px solid var(--border-light); 
            transition: all 0.3s ease; 
            box-shadow: var(--shadow-soft);
            min-height: 200px;
            display: flex;
            flex-direction: column;
        }
        .stock-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-soft); }
        .stock-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: flex-start;
            margin-bottom: 15px; 
            flex-shrink: 0;
        }
.investment-controls { 
    display: grid; 
    grid-template-columns: 1fr 1fr; 
    gap: 10px; 
    margin-top: auto;
    padding-top: 15px;
    width: 100%;
    box-sizing: border-box;
}
        .investment-controls input { 
            padding: 8px; 
            border: 1px solid var(--border-light); 
            border-radius: 6px; 
            background: var(--bg-dark);
            color: var(--text-primary); 
            font-size: 13px; 
            width: 100%; 
            max-width: 100%;
            box-sizing: border-box;
            overflow: hidden;
        }
        .investment-controls label {
            display: block;
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 5px;
            font-weight: 500;
        }
        .asset-type-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .stock-asset { background-color: #8A2BE2; }
        .index-asset { background-color: #4ECDC4; }
        .other-asset { background-color: #FF6B6B; }
        
        .chart-container { 
            height: 450px; 
            margin: 20px 0; 
            background: var(--bg-panel); 
            padding: 25px; 
            border-radius: var(--radius-lg); 
            border: 1px solid var(--border-panel);
            position: relative;
        }
        .chart-container canvas {
            max-height: 100% !important;
        }
        
        .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 20px 0; }
        .card { 
    background: linear-gradient(145deg, #2A2A2A, #232323); 
    padding: 24px; 
    border-radius: 4px; 
    border-left: 4px solid #8b7355; 
    transition: all 0.3s ease;
    box-shadow: 0 10px 25px rgba(139, 115, 85, 0.1), 0 6px 12px rgba(0, 0, 0, 0.15);
    border: 1px solid var(--border-light);
}
        .card:hover { 
    transform: translateY(-4px); 
    box-shadow: 0 14px 30px rgba(139, 115, 85, 0.15), 0 8px 16px rgba(0, 0, 0, 0.1);
    border-color: rgba(139, 115, 85, 0.3);
    border-left-width: 5px;
}
        
        .data-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .data-table th, .data-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid var(--border-light); }
        .data-table th { background: var(--color-primary); color: white; }
        
        .positive { 
    color: var(--accent-positive); 
    font-weight: 600;
    text-shadow: 0 0 8px rgba(138, 43, 226, 0.2);
}
        .negative { 
    color: var(--accent-negative); 
    font-weight: 600;
    text-shadow: 0 0 8px rgba(220, 38, 38, 0.2);
}
        
        .status-bar {
    display: flex; 
    justify-content: center; 
    align-items: center;
    padding: 1px 8px; 
    background: rgba(26, 26, 26, 0.4); 
    border-radius: 4px; 
    margin-bottom: 8px; 
    flex-wrap: nowrap; 
    gap: 6px; 
    color: var(--text-primary);
    border: 1px solid rgba(138, 43, 226, 0.1);
    box-shadow: none;
    font-size: 5px;
    min-height: 14px;
    white-space: nowrap;
    overflow-x: auto;
}

.status-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    font-weight: 500;
}

.status-item i {
    color: var(--accent-primary);
    font-size: 16px;
}

.smi-indicator {
    background: rgba(138, 43, 226, 0.1);
    padding: 12px 16px;
    border-radius: 12px;
    border: 1px solid rgba(138, 43, 226, 0.2);
    position: relative;
}

.mini-chart {
    display: flex;
    align-items: end;
    gap: 2px;
    height: 20px;
    margin-left: 8px;
}

.chart-bar {
    width: 3px;
    border-radius: 1px;
    transition: all 0.3s ease;
}

.market-status-indicator {
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
}

.market-status-indicator.open {
    background: #4CAF50;
    color: white;
}

.market-status-indicator.closed {
    background: #f44336;
    color: white;
}
        
        .market-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .market-item { background: var(--bg-panel); padding: 15px; border-radius: var(--radius-lg); text-align: center; border: 1px solid var(--border-panel); }
        
        .news-item { padding: 15px; border-bottom: 1px solid var(--border-light); }
        .news-item:last-child { border-bottom: none; }
        
        .assets-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
        .asset-card { background: var(--bg-panel); padding: 20px; border-radius: var(--radius-lg); border: 1px solid var(--border-panel); }
        
        .formula-box { 
            background: #2A2A2A; 
            color: #E6E6E6; 
            padding: 15px; 
            border-radius: var(--radius-lg); 
            margin: 10px 0; 
            font-family: monospace; 
            border: 1px solid #8b7355;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            font-size: 1.05rem;
        } /* WINDOWS PERFORMANCE FIX - STUFE 1 */
/* FINALE LÖSUNG - OPTIMIERT FÜR WINDOWS, ORIGINAL FÜR MAC */
.performance-mode .layer {
    animation-duration: 40s, 50s, 60s !important;
    filter: blur(30px) !important;
}

.performance-mode .pulse {
    animation-duration: 20s !important;
    opacity: 0.04 !important;
}
        
        .linkedin-link { color: var(--color-primary); text-decoration: none; display: inline-flex; align-items: center; gap: 5px; }
        
        .asset-type-indicator { 
            display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; 
        }
        .stock-asset { background-color: #0A1429; }
        .other-asset { background-color: #28A745; }
        .index-asset { background-color: #6B46C1; }
        
        .total-validation { 
            padding: 10px; 
            border-radius: 6px; 
            margin: 10px 0; 
            font-weight: bold;
        }
        .validation-ok { background: #d4edda; color: #155724; }
        .validation-error { background: #f8d7da; color: #721c24; }
        
        .metric-value { font-size: 24px; font-weight: bold; margin-bottom: 5px; }
        .metric-label { color: var(--text-muted); font-size: 14px; }
        
        .fx-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin: 20px 0; }
        .fx-item { background: var(--bg-panel); padding: 15px; border-radius: var(--radius-lg); text-align: center; border: 1px solid var(--border-panel); }
        
        .methodology-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin: 20px 0; }
        
        .email-link { color: var(--color-primary); text-decoration: none; }
        
        /* Neue Styles für Strategie-Analyse */
        .strategy-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
        .strategy-card { background: var(--bg-panel); padding: 20px; border-radius: var(--radius-lg); border: 1px solid var(--border-panel); border-left: 4px solid; transition: all 0.3s ease; }
        .strategy-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-soft); }
        .strategy-1 { border-left-color: #0A1429; }
        .strategy-2 { border-left-color: #28A745; }
        .strategy-3 { border-left-color: #D52B1E; }
        .strategy-4 { border-left-color: #6B46C1; }
        .strategy-5 { border-left-color: #2B6CB0; }
        
        .comparison-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .comparison-table th, .comparison-table td { padding: 12px 15px; text-align: center; border: 1px solid var(--border-light); }
        .comparison-table th { background: #2A2A2A; color: #E8E8E8; font-weight: 600; }
        .comparison-table tr:nth-child(even) { background: rgba(138, 43, 226, 0.08); }
        .comparison-table tr:nth-child(odd) { background: rgba(42, 42, 42, 0.7); }
        
        .recommendation-badge { 
            display: inline-block; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .badge-optimal { background: #0d6e32; color: #d4edda; border: 1px solid #28a745; }
        .badge-balanced { background: #664d03; color: #fff3cd; border: 1px solid #ffc107; }
        .badge-conservative { background: #002752; color: #cce7ff; border: 1px solid #0d6efd; }
        .badge-aggressive { background: #4f0f16; color: #f8d7da; border: 1px solid #dc3545; }
        
        .strategy-comparison { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin: 20px 0; }
        
        .optimization-result { 
            background: rgba(139, 115, 85, 0.1); 
            padding: 15px; 
            border-radius: var(--radius-lg); 
            margin: 10px 0;
            border-left: 4px solid #8b7355;
            color: #E0E0E0;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        
        /* Landing Page Styles */
        .landing-card {
            background: linear-gradient(145deg, #1F1F1F, #222222);
            border: 1px solid #2C2C2C;
            border-radius: 4px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            min-height: 148px;
            position: relative;
            overflow: hidden;
        }
        
        .landing-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.4), 0 0 15px rgba(139, 115, 85, 0.4);
            border-color: #8b7355;
        }
        
        .landing-card h3 {
            font-family: 'Playfair Display', serif;
            color: #FFFFFF;
            font-size: 18px;
            margin: 0 0 12px 0;
        }
        
        .landing-card p {
            font-family: 'Inter', sans-serif;
            color: #D9D9D9;
            font-size: 13px;
            line-height: 1.4;
            margin: 0;
        }
        
        .landing-card-icon {
            margin-bottom: 15px;
            color: #8A2BE2;
            font-size: 24px;
            opacity: 0.9;
        }
        
        /* Fade in animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Mobile responsiveness */
        @media (max-width: 768px) {
            #landingPanelsContainer {
                grid-template-columns: 1fr;
            }
        }
        
        .rating-score { 
            font-size: 48px; font-weight: bold; color: var(--color-primary); text-align: center;
            margin: 20px 0;
        }
        
        .improvement-indicator { 
            display: inline-flex; align-items: center; gap: 5px; font-weight: bold;
        }
        .improvement-positive { color: var(--accent-positive); }
        .improvement-negative { color: var(--accent-negative); }
        
        /* Neue Styles für Portfolio Entwicklung */
        .performance-metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .performance-card { background: var(--bg-panel); padding: 20px; border-radius: var(--radius-lg); text-align: center; border: 1px solid var(--border-panel); }
        
        .path-simulation { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
        .path-card { background: var(--bg-panel); padding: 20px; border-radius: var(--radius-lg); border: 1px solid var(--border-panel); }
        
        .swot-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0; }
        .swot-card { background: var(--bg-panel); padding: 20px; border-radius: var(--radius-lg); border-left: 4px solid; }
        .strengths { border-left-color: #28A745; }
        .weaknesses { border-left-color: #DC3545; }
        .opportunities { border-left-color: #8b7355; }
        .threats { border-left-color: #6C757D; }
        
        .calculate-section {
            text-align: center;
            margin: 30px 0;
            padding: 30px;
            background: var(--bg-panel);
            color: var(--text-primary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-panel);
        }
        
        .password-error {
            color: #DC3545;
            margin-top: 10px;
            display: none;
        }
        
        .market-analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .market-analysis-card {
            background: #1F1F1F;
            padding: 20px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-light);
            border-left: 4px solid;
        }
        
        .cycle-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .cycle-growth { background: #d4edda; color: #155724; }
        .cycle-cyclical { background: #fff3cd; color: #856404; }
        .cycle-defensive { background: #cce7ff; color: #004085; }
        
        .timeframe-switcher {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .timeframe-btn {
            padding: 8px 16px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .timeframe-btn.active {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }
        
        .scenario-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .scenario-card {
            background: #1F1F1F;
            padding: 20px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-light);
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .scenario-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-soft);
        }
        
        .scenario-normal { border-top: 4px solid #28A745; }
        .scenario-interest { border-top: 4px solid #DC3545; }
        .scenario-inflation { border-top: 4px solid #FFC107; }
        .scenario-recession { border-top: 4px solid #6C757D; }
        .scenario-growth { border-top: 4px solid #8b7355; }
        
        .correlation-matrix {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .correlation-matrix th, .correlation-matrix td {
            padding: 10px;
            text-align: center;
            border: 1px solid var(--border-light);
        }
        
        .correlation-matrix th {
            background: var(--color-primary);
            color: white;
        }
        
        .correlation-value {
            font-weight: bold;
        }
        
        .positive-correlation { background: #d4edda; }
        .negative-correlation { background: #f8d7da; }
        .neutral-correlation { background: #fff3cd; }
        
        .monte-carlo-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .benchmark-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .benchmark-card {
            background: #1F1F1F;
            padding: 20px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-light);
            text-align: center;
        }
        
        .peer-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .peer-card {
            background: #1F1F1F;
            padding: 15px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-light);
            text-align: center;
        }
        
        .refresh-button {
            background: #8b7355;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 2px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .refresh-button:hover {
            background: #6d5a42;
            transform: translateY(-2px);
        }
        
        .auto-refresh-info {
            background: rgba(139, 115, 85, 0.15);
            padding: 12px 16px;
            border-radius: var(--radius-md);
            margin: 15px 0;
            font-size: 14px;
            border-left: 4px solid var(--color-accent);
            color: var(--text-primary);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28A745;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        .price-update-info {
            background: rgba(139, 115, 85, 0.15);
            padding: 12px 16px;
            border-radius: var(--radius-md);
            margin: 12px 0;
            font-size: 14px;
            border-left: 4px solid var(--color-accent);
            color: var(--text-primary);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #8b7355;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .risk-meter {
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .risk-level {
            height: 100%;
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        
        .risk-low { background: #28A745; width: 30%; }
        .risk-medium { background: #FFC107; width: 60%; }
        .risk-high { background: #DC3545; width: 90%; }
        
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        .export-button {
            background: #8b7355;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 2px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .export-button:hover {
            background: #6d5a42;
            transform: translateY(-1px);
        }
        
        .clickable-name {
            color: white;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .clickable-name:hover {
            color: #8b7355;
            text-decoration: underline;
        }
        
        .pdf-download-section {
            text-align: center;
            margin: 40px 0;
            padding: 30px;
            background: linear-gradient(135deg, #0A1429 0%, #1E3A5C 100%);
            color: white;
            border-radius: var(--radius-lg);
        }
        
        .btn-pdf {
            background: #DC3545;
            font-size: 18px;
            padding: 15px 30px;
            margin-top: 15px;
        }
        
        .btn-pdf:hover {
            background: #c82333;
            transform: translateY(-2px);
        }
        
        .asset-performance-chart {
            height: 300px;
            margin: 20px 0;
        }
        
        .news-link {
            color: #8b7355;
            text-decoration: none;
        }
        
        .news-link:hover {
            text-decoration: underline;
        }

        /* Korrelationsmatrix Styles */
        .correlation-heatmap {
            width: 100%;
            height: 500px;
            margin: 20px 0;
        }

        .correlation-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 12px;
        }

        .correlation-table th, .correlation-table td {
            padding: 10px;
            text-align: center;
            border: 1px solid #444;
            font-size: 13px;
        }

        .correlation-table th {
            background: #1A1A1A;
            color: #E8E8E8;
            font-weight: bold;
        }

        .correlation-table td:first-child {
            background: #1A1A1A;
            color: #E8E8E8;
            font-weight: bold;
        }

        .corr-high { 
            background: #2D4A2D; 
            color: #90EE90; 
            font-weight: 600;
        }
        .corr-medium { 
            background: #4A3D2D; 
            color: #FFD700; 
            font-weight: 600;
        }
        .corr-low { 
            background: #4A2D2D; 
            color: #FFB6C1; 
            font-weight: 600;
        }
        .corr-negative { 
            background: #2D3A4A; 
            color: #87CEEB; 
            font-weight: 600;
        }

        /* Value Testing Styles */
        .value-testing-controls {
            margin-bottom: 30px;
        }

        .parameter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .parameter-item {
            display: flex;
            flex-direction: column;
        }

        .parameter-item label {
            color: #E8E8E8;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .parameter-item input {
            padding: 10px;
            border: 1px solid #444;
            border-radius: 6px;
            background: #2A2A2A;
            color: #E8E8E8;
            font-size: 14px;
        }

        .parameter-item input:focus {
            outline: none;
            border-color: #8A2BE2;
            box-shadow: 0 0 0 2px rgba(138, 43, 226, 0.2);
        }

        .analysis-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .loading-container {
            text-align: center;
            padding: 40px;
        }

        .loading-spinner {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .loading-spinner i {
            font-size: 48px;
            color: #8A2BE2;
        }

        .loading-spinner p {
            color: #E8E8E8;
            font-size: 18px;
            margin: 0;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        .progress-bar {
            width: 300px;
            height: 8px;
            background: #333;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #8A2BE2, #B05EED);
            width: 0%;
            transition: width 0.3s ease;
        }

        .value-testing-results {
            margin-top: 30px;
        }

        .portfolio-summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .summary-item {
            text-align: center;
            padding: 20px;
            background: linear-gradient(145deg, #2A2A2A, #232323);
            border-radius: 8px;
            border: 1px solid #444;
        }

        .summary-item h4 {
            color: #E8E8E8;
            margin-bottom: 10px;
            font-size: 14px;
            font-weight: 600;
        }

        .summary-item p {
            color: #8A2BE2;
            font-size: 24px;
            font-weight: bold;
            margin: 0;
        }

        .value-analysis-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .value-analysis-table th,
        .value-analysis-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #444;
        }

        .value-analysis-table th {
            background: #1A1A1A;
            color: #E8E8E8;
            font-weight: 600;
            font-size: 14px;
        }

        .value-analysis-table td {
            color: #D0D0D0;
            font-size: 13px;
        }

        .value-analysis-table tr:hover {
            background: rgba(138, 43, 226, 0.1);
        }

        .recommendation-buy {
            color: #4CAF50;
            font-weight: bold;
        }

        .recommendation-hold {
            color: #FFD700;
            font-weight: bold;
        }

        .recommendation-sell {
            color: #FF6B6B;
            font-weight: bold;
        }

        .score-bar {
            width: 100%;
            height: 20px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .score-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .score-high { background: linear-gradient(90deg, #4CAF50, #66BB6A); }
        .score-medium { background: linear-gradient(90deg, #FFD700, #FFE082); }
        .score-low { background: linear-gradient(90deg, #FF6B6B, #FF8A80); }

        .charts-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .sources-list {
            display: grid;
            gap: 15px;
        }

        .source-item {
            padding: 15px;
            background: #2A2A2A;
            border-radius: 6px;
            border-left: 4px solid #8A2BE2;
        }

        .source-item h5 {
            color: #E8E8E8;
            margin: 0 0 8px 0;
            font-size: 14px;
        }

        .source-item p {
            color: #D0D0D0;
            margin: 4px 0;
            font-size: 13px;
        }

        .source-item a {
            color: #8A2BE2;
            text-decoration: none;
        }

        .source-item a:hover {
            text-decoration: underline;
        }

        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: #1A1A1A;
            padding: 30px;
            border-radius: 8px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            border: 1px solid #444;
        }

        .close {
            position: absolute;
            top: 15px;
            right: 20px;
            color: #E8E8E8;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #8A2BE2;
        }

        .asset-detail-content h3 {
            color: #E8E8E8;
            margin-bottom: 20px;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .detail-item {
            padding: 15px;
            background: #2A2A2A;
            border-radius: 6px;
        }

        .detail-item h5 {
            color: #E8E8E8;
            margin: 0 0 8px 0;
            font-size: 14px;
        }

        .detail-item p {
            color: #D0D0D0;
            margin: 0;
            font-size: 16px;
            font-weight: 600;
        }

        .valuation-methods {
            margin-top: 20px;
        }

        .valuation-method {
            margin-bottom: 20px;
            padding: 15px;
            background: #2A2A2A;
            border-radius: 6px;
            border-left: 4px solid #8A2BE2;
        }

        .valuation-method h5 {
            color: #E8E8E8;
            margin: 0 0 10px 0;
        }

        .valuation-method p {
            color: #D0D0D0;
            margin: 5px 0;
        }

        /* Investment Strategy Modules Styles */
        .momentum-controls, .buyhold-controls, .carry-controls {
            margin-bottom: 30px;
        }

        .momentum-analysis-table, .buyhold-analysis-table, .carry-analysis-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .momentum-analysis-table th,
        .momentum-analysis-table td,
        .buyhold-analysis-table th,
        .buyhold-analysis-table td,
        .carry-analysis-table th,
        .carry-analysis-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #444;
            font-size: 13px;
        }

        .momentum-analysis-table th,
        .buyhold-analysis-table th,
        .carry-analysis-table th {
            background: #1A1A1A;
            color: #E8E8E8;
            font-weight: 600;
        }

        .momentum-analysis-table td,
        .buyhold-analysis-table td,
        .carry-analysis-table td {
            color: #D0D0D0;
        }

        .momentum-analysis-table tr:hover,
        .buyhold-analysis-table tr:hover,
        .carry-analysis-table tr:hover {
            background: rgba(138, 43, 226, 0.1);
        }

        .momentum-results, .buyhold-results, .carry-results {
            margin-top: 30px;
        }

        .performance-positive {
            color: #4CAF50;
            font-weight: bold;
        }

        .performance-negative {
            color: #FF6B6B;
            font-weight: bold;
        }

        .performance-neutral {
            color: #FFD700;
            font-weight: bold;
        }

        .recommendation-strong-buy {
            color: #4CAF50;
            font-weight: bold;
        }

        .recommendation-buy {
            color: #66BB6A;
            font-weight: bold;
        }

        .recommendation-neutral {
            color: #FFD700;
            font-weight: bold;
        }

        .recommendation-avoid {
            color: #FF6B6B;
            font-weight: bold;
        }

        .recommendation-recommend {
            color: #4CAF50;
            font-weight: bold;
        }

        .recommendation-opportunistic {
            color: #FFD700;
            font-weight: bold;
        }

        .heatmap-cell {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin: 2px;
            border-radius: 3px;
            text-align: center;
            line-height: 20px;
            font-size: 10px;
            font-weight: bold;
        }

        .heatmap-positive {
            background: #4CAF50;
            color: white;
        }

        .heatmap-negative {
            background: #FF6B6B;
            color: white;
        }

        .heatmap-neutral {
            background: #FFD700;
            color: black;
        }

        .simulation-chart {
            margin-top: 20px;
        }

        .carry-simulation {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }

        .simulation-item {
            text-align: center;
            padding: 10px;
            background: #2A2A2A;
            border-radius: 6px;
            border: 1px solid #444;
        }

        .simulation-item h6 {
            color: #E8E8E8;
            margin: 0 0 5px 0;
            font-size: 12px;
        }

        .simulation-item p {
            color: #8A2BE2;
            margin: 0;
            font-weight: bold;
            font-size: 14px;
        }

        .strategy-navigation {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .strategy-card {
            background: linear-gradient(145deg, #2A2A2A, #232323);
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #444;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .strategy-card:hover {
            border-color: #8A2BE2;
            box-shadow: 0 4px 20px rgba(138, 43, 226, 0.2);
            transform: translateY(-2px);
        }

        .strategy-card h3 {
            color: #8A2BE2;
            margin: 0 0 15px 0;
            font-size: 18px;
        }

        .strategy-card p {
            color: #D0D0D0;
            margin: 0 0 15px 0;
            font-size: 14px;
            line-height: 1.5;
        }

        .strategy-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .strategy-feature {
            padding: 8px;
            background: rgba(138, 43, 226, 0.1);
            border-radius: 4px;
            text-align: center;
            font-size: 12px;
            color: #E8E8E8;
        }

        .strategy-button {
            width: 100%;
            padding: 10px;
            background: linear-gradient(90deg, #8A2BE2, #B05EED);
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .strategy-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(138, 43, 226, 0.3);
        }

        .correlation-legend {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 10px 0;
            font-size: 12px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
        }

        .welcome-screen {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(135deg, #1a0f42 0%, #0A1429 30%, #0A1429 70%, #1a0f42 100%);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 9999;

        }

        .welcome-screen.active {
            display: flex;

        }

        .welcome-content {
            text-align: center;
            transform: translateY(20px);
            opacity: 0;
            animation: welcomeSlideIn 1s ease 1s forwards;
        }

        .welcome-title {
            font-size: 3.5rem;
            font-weight: 700;
            color: white;
            margin-bottom: 1rem;
            text-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .welcome-subtitle {
            font-size: 1.2rem;
            color: rgba(255,255,255,0.8);
            font-weight: 300;
        }
.welcome-author {
    font-size: 1rem;
    color: rgba(255,255,255,0.7);
    font-weight: 300;
    margin-bottom: 2rem;
}
        .loading-bar {
            width: 200px;
            height: 3px;
            background: rgba(255,255,255,0.2);
            margin-top: 2rem;
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress {
            width: 0%;
            height: 100%;
            background: #333333;
            animation: loadingFill 3s ease 1s forwards;
        }

        @keyframes welcomeSlideIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes loadingFill {
            0% { width: 0%; }
            60% { width: 70%; }
            80% { width: 85%; }
            100% { width: 100%; }
        }
        /* Finance Footer Styles */
        /* Footer styles are handled by utility classes in the HTML */
        .market-open { color: #28A745; font-weight: bold; }
        .market-closed { color: #DC3545; }
        .market-status { margin: 0 5px; }
/* Violet Background Styles */
:root{
    /* Basis / Branding-empfohlene Farben */
    --base-black: #050510;      /* sehr dunkler Grundton (nicht reines Schwarz) */
    --violet-1:  #0a0f2c;       /* sehr dunkles Blau-Violett */
    --violet-2:  #1a0b38;       /* tiefes Violett */
    --violet-3:  #2e0f54;       /* edles Lila */
    --violet-4:  #3c1a70;       /* Blau-Violett für Tiefe */

    /* Bewegung (kleiner = schneller) */
    --d1: 10s;
    --d2: 14s;
    --d3: 20s;

    /* Unschärfe / Sichtbarkeit (anpassbar) */
    --blur1: 48px;
    --blur2: 84px;
    --blur3: 120px;
    --opa1: 0.96;
    --opa2: 0.82;
    --opa3: 0.74;
}

/* Fullscreen background container */
.bg {
    position: fixed;
    inset: 0;
    z-index: -1; /* WICHTIG: Hinter allen Inhalten */
    pointer-events: none;
    isolation: isolate;
    background: var(--base-black);
}

/* Layers use repeating radial gradients and animate background-position diagonally.
   Because they repeat, the motion loops seamlessly (no snapping). */
.layer {
    position: absolute;
    inset: -40%;
    pointer-events: none;
    background-repeat: repeat;
    mix-blend-mode: screen;
    will-change: background-position, transform, opacity;
}

/* Layer 1 - vorne (fein strukturiert, schneller) */
.l1 {
    background-image:
        radial-gradient(closest-side, rgba(138,43,226,0.25) 0%, rgba(138,43,226,0) 48%),
        radial-gradient(circle at 18% 82%, rgba(138,43,226,0.18) 0%, rgba(138,43,226,0) 44%);
    background-size: 1200px 1200px, 1600px 1600px;
    filter: blur(var(--blur1)) saturate(116%);
    opacity: var(--opa1);
    animation:
        bgMove1 var(--d1) linear infinite,
        wave1 calc(var(--d1) * 1.12) ease-in-out infinite;
}

/* Layer 2 - mitte (mittlere Tiefe, moderat) */
.l2 {
    background-image:
        radial-gradient(circle at 16% 86%, rgba(138,43,226,0.15) 0%, rgba(138,43,226,0) 42%),
        radial-gradient(circle at 8% 92%, rgba(138,43,226,0.12) 0%, rgba(138,43,226,0) 38%);
    background-size: 1800px 1800px, 2200px 2200px;
    filter: blur(var(--blur2)) saturate(106%);
    opacity: var(--opa2);
    animation:
        bgMove2 var(--d2) linear infinite,
        wave2 calc(var(--d2) * 1.18) ease-in-out infinite;
}

/* Layer 3 - hinten (groß, sehr weich) */
.l3 {
    background-image:
        radial-gradient(circle at 12% 92%, rgba(138,43,226,0.10) 0%, rgba(138,43,226,0) 36%),
        radial-gradient(circle at 22% 72%, rgba(138,43,226,0.08) 0%, rgba(138,43,226,0) 40%);
    background-size: 2600px 2600px, 3000px 3000px;
    filter: blur(var(--blur3)) saturate(102%);
    opacity: var(--opa3);
    animation:
        bgMove3 var(--d3) linear infinite,
        wave3 calc(var(--d3) * 1.22) ease-in-out infinite;
}

/* subtle overlay for micro-life */
.pulse {
    position: absolute;
    inset: -60%;
    background: linear-gradient(135deg, rgba(255,255,255,0.01), rgba(255,255,255,0) 22%);
    filter: blur(160px);
    mix-blend-mode: overlay;
    animation: pulse 12s ease-in-out infinite;
    opacity: 0.07;
    pointer-events: none;
}

/* fine grain texture for luxury finish */
.grain {
    position: fixed;
    inset: 0;
    z-index: -1; /* WICHTIG: Hinter allen Inhalten */
    pointer-events: none;
    opacity: 0.03;
    background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='64' height='64' viewBox='0 0 64 64'><filter id='g'><feTurbulence baseFrequency='0.9' numOctaves='1' seed='29' /></filter><rect width='100%' height='100%' filter='url(%23g)' opacity='0.18' /></svg>");
    mix-blend-mode: overlay;
}

/* KEYFRAMES — diagonal translation of repeating background tiles (seamless loop) */
@keyframes bgMove1 {
    from { background-position: -1400px -1400px, -1800px -1800px; }
    to   { background-position: 1400px 1400px, 1800px 1800px; }
}
@keyframes bgMove2 {
    from { background-position: -1800px -1800px, -2200px -2200px; }
    to   { background-position: 1800px 1800px, 2200px 2200px; }
}
@keyframes bgMove3 {
    from { background-position: -2400px -2400px, -2800px -2800px; }
    to   { background-position: 2400px 2400px, 2800px 2800px; }
}

/* gentle orthogonal wave movement for organic flow */
@keyframes wave1 {
    0%   { transform: translate(0%, 0%); }
    25%  { transform: translate(0.35%, -0.18%); }
    50%  { transform: translate(0%, -0.36%); }
    75%  { transform: translate(-0.35%, -0.18%); }
    100% { transform: translate(0%, 0%); }
}
@keyframes wave2 {
    0%   { transform: translate(0%, 0%); }
    25%  { transform: translate(0.52%, -0.28%); }
    50%  { transform: translate(0%, -0.56%); }
    75%  { transform: translate(-0.52%, -0.28%); }
    100% { transform: translate(0%, 0%); }
}
@keyframes wave3 {
    0%   { transform: translate(0%, 0%); }
    25%  { transform: translate(0.75%, -0.36%); }
    50%  { transform: translate(0%, -0.72%); }
    75%  { transform: translate(-0.75%, -0.36%); }
    100% { transform: translate(0%, 0%); }
}

/* micro pulse */
@keyframes pulse {
    0%   { opacity: 0.05; transform: scale(1) translate(0,0); }
    50%  { opacity: 0.11; transform: scale(1.01) translate(0.12%, -0.18%); }
    100% { opacity: 0.05; transform: scale(1) translate(0,0); }
}

/* respect user motion preferences */
@media (prefers-reduced-motion: reduce) {
    .layer, .pulse { animation: none !important; transform: none !important; }
    .grain { opacity: 0.02 !important; }
}
/* NUR WINDOWS PERFORMANCE OPTIMIERUNGEN - STANDIMAGE */
.performance-mode .layer {
    animation: none !important;
    filter: blur(40px) !important;
}

.performance-mode .pulse {
    display: none !important;
}

.performance-mode .l1 { opacity: 0.9; }
.performance-mode .l2 { opacity: 0.7; }
.performance-mode .l3 { opacity: 0.5; }

/* SMOOTH SCROLLING FIX */
html, body {
    overflow-x: hidden;
    overflow-y: auto;
    height: 100%;
    scroll-behavior: smooth;
}

.performance-mode main {
    transform: translate3d(0, 0, 0);
    backface-visibility: hidden;
    will-change: transform;
}

/* Getting Started Page Styles */
.steps-container {
    display: flex;
    flex-direction: column;
    gap: 20px;
    margin: 30px 0;
}

.step {
    display: flex;
    align-items: flex-start;
    background: linear-gradient(145deg, #262626, #1a1a1a);
    border-radius: 10px;
    padding: 20px;
    transition: transform 0.3s, box-shadow 0.3s;
}

.step:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
}

.step-number {
    background: linear-gradient(145deg, #8A2BE2, #6B24B2);
    color: white;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1.2rem;
    margin-right: 20px;
    flex-shrink: 0;
}

.step-content {
    flex: 1;
}

.step-btn {
    margin-top: 10px;
}

.features-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.feature-item {
    background: linear-gradient(145deg, #262626, #1a1a1a);
    border-radius: 10px;
    padding: 20px;
    text-align: center;
    transition: transform 0.3s;
}

.feature-item:hover {
    transform: translateY(-5px);
}

.feature-icon {
    font-size: 2.5rem;
    margin-bottom: 15px;
    color: #8A2BE2;
}

.quick-links-container {
    margin-top: 30px;
}

.quick-links {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 15px;
}

.quick-link {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    background: linear-gradient(145deg, #262626, #1a1a1a);
    border-radius: 10px;
    padding: 20px;
    text-decoration: none;
    color: #E0E0E0;
    transition: all 0.3s;
}

.quick-link:hover {
    background: linear-gradient(145deg, #2D2D2D, #212121);
    transform: translateY(-5px);
    color: #8A2BE2;
}

.quick-link i {
    font-size: 2rem;
    margin-bottom: 10px;
}

/* Investing Page Styles */
.principles-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.principle-item {
    background: linear-gradient(145deg, #262626, #1a1a1a);
    border-radius: 10px;
    padding: 20px;
    transition: transform 0.3s;
}

.principle-item:hover {
    transform: translateY(-5px);
}

.principle-image {
    height: 150px;
    margin-top: 15px;
    border-radius: 8px;
    background-color: #333;
    background-size: cover;
    background-position: center;
}

.tabs-container {
    margin-top: 20px;
}

.tabs {
    display: flex;
    flex-wrap: wrap;
    border-bottom: 1px solid #333;
    margin-bottom: 20px;
}

.tab {
    padding: 10px 20px;
    cursor: pointer;
    transition: all 0.3s;
}

.tab.active {
    color: #8A2BE2;
    border-bottom: 2px solid #8A2BE2;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
    animation: fade-in 0.3s ease-out;
}

.strategy-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}

.strategy-table th,
.strategy-table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #333;
}

.strategy-table th {
    background-color: #222;
    color: #E0E0E0;
}

.strategy-table tr:hover {
    background-color: #282828;
}

/* News Styling */
.news-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid #333;
}

.news-item {
    background: #1A1A1A;
    border: 1px solid #333;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 15px;
    transition: all 0.3s ease;
}

.news-item:hover {
    background: #222;
    border-color: #8A2BE2;
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(138, 43, 226, 0.2);
}

.news-item .news-header {
    margin-bottom: 10px;
    padding-bottom: 10px;
    border-bottom: 1px solid #333;
}

.news-title {
    color: #E8E8E8;
    text-decoration: none;
    font-size: 16px;
    font-weight: 600;
    line-height: 1.4;
    transition: color 0.3s ease;
}

.news-title:hover {
    color: #8A2BE2;
    text-decoration: underline;
}

.news-meta {
    display: flex;
    gap: 15px;
    margin-top: 8px;
}

.news-source {
    background: #8A2BE2;
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
}

.news-time {
    color: #888;
    font-size: 12px;
    font-style: italic;
}

.news-description {
    color: #D0D0D0;
    line-height: 1.6;
    margin: 0;
}

.news-loading {
    text-align: center;
    color: #888;
    padding: 40px;
    font-size: 16px;
}

.news-loading i {
    margin-right: 10px;
    color: #8A2BE2;
}

/* Asset Section Styling */
.asset-section {
    background: #1A1A1A;
    border: 1px solid #333;
    border-radius: 12px;
    padding: 30px;
    margin-bottom: 30px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

.asset-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 2px solid #8A2BE2;
}

.asset-header h3 {
    color: #E8E8E8;
    font-size: 24px;
    margin: 0;
}

.asset-badges {
    display: flex;
    gap: 10px;
}

.risk-badge, .return-badge, .liquidity-badge {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
}

.risk-badge.high, .return-badge.high, .liquidity-badge.high {
    background: #FF6B6B;
    color: white;
}

.risk-badge.medium, .return-badge.medium, .liquidity-badge.medium {
    background: #FFD700;
    color: #1A1A1A;
}

.risk-badge.low, .return-badge.low, .liquidity-badge.low {
    background: #90EE90;
    color: #1A1A1A;
}

.return-badge.stable {
    background: #87CEEB;
    color: #1A1A1A;
}

.risk-badge.variable, .return-badge.variable, .liquidity-badge.variable {
    background: #DDA0DD;
    color: white;
}

.theory-content h4 {
    color: #8A2BE2;
    font-size: 20px;
    margin: 25px 0 15px 0;
    border-left: 4px solid #8A2BE2;
    padding-left: 15px;
}

.theory-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 25px;
}

.theory-card {
    background: #222;
    border: 1px solid #444;
    border-radius: 8px;
    padding: 20px;
    transition: all 0.3s ease;
}

.theory-card:hover {
    border-color: #8A2BE2;
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(138, 43, 226, 0.2);
}

.theory-card h5 {
    color: #E8E8E8;
    font-size: 16px;
    margin: 0 0 10px 0;
}

.theory-card p {
    color: #D0D0D0;
    line-height: 1.6;
    margin: 0 0 10px 0;
}

.formula {
    background: #0A0A0A;
    border: 1px solid #8A2BE2;
    border-radius: 4px;
    padding: 10px;
    font-family: 'Courier New', monospace;
    color: #8A2BE2;
    font-size: 14px;
    text-align: center;
    margin-top: 10px;
}

.practice-content {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 20px;
}

.practice-item {
    background: #1F1F1F;
    border: 1px solid #444;
    border-radius: 8px;
    padding: 20px;
    transition: all 0.3s ease;
}

.practice-item:hover {
    border-color: #8A2BE2;
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(138, 43, 226, 0.1);
}

.practice-item h5 {
    color: #E8E8E8;
    font-size: 16px;
    margin: 0 0 10px 0;
    border-bottom: 1px solid #333;
    padding-bottom: 8px;
}

.practice-item p {
    color: #D0D0D0;
    line-height: 1.6;
    margin: 0 0 8px 0;
}

.practice-item p:last-child {
    margin-bottom: 0;
}

/* Backtesting Module Styles */
.backtesting-controls {
    background: #1A1A1A;
    border: 1px solid #333;
    border-radius: 12px;
    padding: 25px;
    margin: 20px 0;
}

.strategy-parameters {
    margin: 20px 0;
    padding: 20px;
    background: #222;
    border-radius: 8px;
    border-left: 4px solid #8A2BE2;
}

.backtesting-results {
    margin-top: 30px;
}

.metric-value {
    font-size: 24px;
    font-weight: bold;
    color: #8A2BE2;
    margin-top: 5px;
}

.summary-item h4 {
    color: #E0E0E0;
    font-size: 14px;
    margin-bottom: 5px;
    opacity: 0.8;
}

/* Comprehensive PDF Download Styles */
.comprehensive-pdf-section {
    background: linear-gradient(135deg, #1A1A1A 0%, #2A2A2A 100%);
    border: 1px solid #8A2BE2;
    border-radius: 16px;
    margin: 30px 0;
    overflow: hidden;
    position: relative;
}

.comprehensive-pdf-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #8A2BE2, #B05EED, #8A2BE2);
    background-size: 200% 100%;
    animation: shimmer 3s ease-in-out infinite;
}

@keyframes shimmer {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
}

.pdf-download-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 40px;
    margin-top: 20px;
}

.pdf-preview {
    background: #222;
    border-radius: 12px;
    padding: 25px;
    border: 1px solid #333;
}

.pdf-preview h4 {
    color: #8A2BE2;
    font-size: 18px;
    margin-bottom: 20px;
    font-family: 'Playfair Display', serif;
}

.pdf-content-list {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
}

.content-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    background: #1A1A1A;
    border-radius: 8px;
    border-left: 3px solid #8A2BE2;
    transition: all 0.3s ease;
}

.content-item:hover {
    background: #2A2A2A;
    transform: translateX(5px);
}

.content-item i {
    color: #8A2BE2;
    font-size: 16px;
    width: 20px;
    text-align: center;
}

.content-item span {
    color: #E0E0E0;
    font-size: 14px;
    font-weight: 500;
}

.pdf-download-form {
    background: #222;
    border-radius: 12px;
    padding: 25px;
    border: 1px solid #333;
}

.pdf-download-form h4 {
    color: #8A2BE2;
    font-size: 18px;
    margin-bottom: 15px;
    font-family: 'Playfair Display', serif;
}

.pdf-download-form p {
    color: #B0B0B0;
    margin-bottom: 20px;
    font-size: 14px;
}

.password-input-group {
    position: relative;
    margin-bottom: 20px;
}

.password-input {
    width: 100%;
    padding: 15px 50px 15px 15px;
    background: #1A1A1A;
    border: 2px solid #333;
    border-radius: 8px;
    color: #E0E0E0;
    font-size: 16px;
    transition: all 0.3s ease;
}

.password-input:focus {
    outline: none;
    border-color: #8A2BE2;
    box-shadow: 0 0 0 3px rgba(138, 43, 226, 0.1);
}

.password-toggle {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: #8A2BE2;
    cursor: pointer;
    font-size: 16px;
    padding: 5px;
    transition: color 0.3s ease;
}

.password-toggle:hover {
    color: #B05EED;
}

.pdf-generate-btn {
    width: 100%;
    padding: 15px;
    background: linear-gradient(135deg, #8A2BE2, #B05EED);
    border: none;
    border-radius: 8px;
    color: white;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-bottom: 15px;
}

.pdf-generate-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(138, 43, 226, 0.3);
}

.pdf-generate-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
}

.pdf-info {
    color: #B0B0B0;
    font-size: 12px;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.pdf-features {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

.feature-tag {
    display: flex;
    align-items: center;
    gap: 6px;
    background: rgba(138, 43, 226, 0.1);
    color: #8A2BE2;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 500;
    border: 1px solid rgba(138, 43, 226, 0.2);
}

.feature-tag i {
    font-size: 10px;
}

@media (max-width: 768px) {
    .pdf-download-container {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .pdf-preview, .pdf-download-form {
        padding: 20px;
    }
}

/* Getting Started Structure Styles */
.website-structure {
    margin: 20px 0;
}

.structure-section {
    margin-bottom: 30px;
    padding: 20px;
    background: #1A1A1A;
    border-radius: 12px;
    border-left: 4px solid #8A2BE2;
}

.structure-section h4 {
    color: #8A2BE2;
    font-size: 18px;
    margin-bottom: 15px;
    font-family: 'Playfair Display', serif;
}

.structure-items {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 15px;
}

.structure-item {
    display: flex;
    align-items: flex-start;
    gap: 15px;
    padding: 15px;
    background: #222;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 1px solid #333;
}

.structure-item:hover {
    background: #2A2A2A;
    border-color: #8A2BE2;
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(138, 43, 226, 0.2);
}

.structure-item i {
    font-size: 24px;
    color: #8A2BE2;
    margin-top: 5px;
    min-width: 30px;
}

.structure-item strong {
    color: #E0E0E0;
    font-size: 16px;
    display: block;
    margin-bottom: 5px;
}

.structure-item p {
    color: #B0B0B0;
    font-size: 14px;
    line-height: 1.4;
    margin: 0;
}

.step-actions {
    display: flex;
    gap: 10px;
    margin-top: 15px;
    flex-wrap: wrap;
}

.step-actions .btn {
    font-size: 12px;
    padding: 8px 16px;
}

}  </style>
<script>
    // Initial Footer ausblenden für Login-Bildschirm
    window.onload = function() {
        document.querySelector('footer').style.display = 'none';
        
        // Ensure login screen is properly centered
        const loginScreen = document.getElementById('passwordProtection');
        if (loginScreen) {
            loginScreen.style.display = 'flex';
            loginScreen.style.justifyContent = 'center';
            loginScreen.style.alignItems = 'center';
            loginScreen.style.width = '100vw';
            loginScreen.style.height = '100vh';
        }
    }
</script>
</head>
<body class="sap-theme-dark" style="margin: 0; padding: 0;">
    <!-- ========== LOGIN SCREEN v3.0 FINAL - UPDATED 2025-10-11 22:38 ========== -->
    <div id="passwordProtection" style="display: flex; justify-content: center; align-items: center; width: 100vw; height: 100vh; position: fixed; top: 0; left: 0; background: #000000; z-index: 10000;">
        <div style="background: #000000; padding: 60px; border-radius: 4px; box-shadow: none; text-align: center; max-width: 500px; width: 90%; border: none; margin: 0 auto;">
            <!-- Title UPDATED - Swiss in BEIGE 52px -->
            <div style="margin-bottom: 30px; line-height: 1.1;">
                <span style="color: #8b7355 !important; font-size: 52px !important; font-weight: 300 !important; font-family: 'Playfair Display', serif !important; display: inline !important;">Swiss</span>
                <span style="color: #FFFFFF !important; font-size: 52px !important; font-weight: 300 !important; font-family: 'Playfair Display', serif !important; display: inline !important;"> Asset Pro</span>
            </div>
            
            <p style="margin-bottom: 25px; color: #E8E8E8; font-size: 15px;">Bitte geben Sie das Passwort ein:</p>
            <input type="password" id="passwordInput" placeholder="Passwort" onkeypress="if(event.key === 'Enter') checkPassword()" style="width: 100%; padding: 14px; border: 1px solid #454545; border-radius: 4px; margin-bottom: 18px; font-size: 16px; background: #1a1a1a; color: white; outline: none !important; box-sizing: border-box;">
            <button onclick="checkPassword()" id="accessButton" style="background: #8b7355 !important; color: white !important; font-weight: 600; padding: 14px 30px; border-radius: 2px; box-shadow: none; border: none; cursor: pointer; width: 100%; font-size: 17px; outline: none !important;">Zugang erhalten</button>
            <p id="passwordError" style="color: #DC3545; margin-top: 12px; display: none; font-size: 14px;">Falsches Passwort. Bitte versuchen Sie es erneut.</p>
            <p style="margin-top: 20px; font-size: 13px; color: #999;">by Ahmed Choudhary</p>
        </div>
    </div>

<div class="welcome-screen" id="welcomeScreen">
    <div class="welcome-content">
        <h1 class="welcome-title">Swiss Asset Pro</h1>
        <p class="welcome-subtitle">Professional Portfolio Simulation</p>
        <p class="welcome-author">by Ahmed Choudhary</p>
        
        <div class="loading-bar">
            <div class="loading-progress"></div>
        </div>
        
        <!-- VERSCHWINDENDE AKTIEN-LINIE - 2025-10-12 00:43 -->
        <div class="stock-graph-fade" style="margin-top: 40px; display: flex; justify-content: center;">
            <div class="graph-container-fade" style="width: 300px; height: 80px; position: relative;">
                <svg viewBox="0 0 300 80" preserveAspectRatio="none" style="width: 100%; height: 100%;">
                    <!-- Aktien-Linie die langsam verschwindet -->
                    <path id="fadingStockLine" d="M0,60 L50,55 L100,70 L150,65 L200,75 L250,68 L300,20" 
                          style="fill: none; stroke: #8b7355; stroke-width: 3; stroke-linecap: round; stroke-linejoin: round; opacity: 1; filter: drop-shadow(0 0 10px rgba(139, 115, 85, 0.8)); transition: opacity 1s ease-out;" />
                </svg>
            </div>
        </div>
        
    </div>
</div>

<style>
.welcome-screen {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: #0A0A0A;
    display: none;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    z-index: 9999;
}

.welcome-screen.active {
    display: flex;
}

.welcome-content {
    text-align: center;
    transform: translateY(0);
    opacity: 1;
    animation: welcomeSlideIn 0.8s ease 0.2s forwards;
}

.welcome-title {
    font-family: var(--font-heading);
    font-size: 3.5rem;
    font-weight: 700;
    color: var(--color-accent);
    margin-bottom: 1.5rem;
    text-shadow: 0 0 25px rgba(138, 43, 226, 0.3);
    letter-spacing: -1px;
}

.welcome-subtitle {
    font-family: var(--font-body);
    font-size: 1.2rem;
    color: rgba(255,255,255,0.8);
    font-weight: 300;
    letter-spacing: 0.3px;
}

.welcome-author {
    font-size: 1rem;
    color: rgba(255,255,255,0.7);
    font-weight: 300;
    margin-bottom: 2rem;
}

.loading-bar {
    width: 250px;
    height: 4px;
    background: rgba(255,255,255,0.1);
    margin: 2.5rem auto 0;
    border-radius: 4px;
    overflow: hidden;
}

        .loading-progress {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #d4af37, #8b7355);
            animation: loadingFill 3.5s cubic-bezier(0.34, 1.56, 0.64, 1) 0.3s forwards;
            box-shadow: 0 0 15px rgba(139, 115, 85, 0.6);
        }/* NEUE AKTIEN-GRAPH ANIMATION */
.stock-graph-animation {
    margin-top: 40px;
    display: flex;
    justify-content: center;
}

.graph-container {
    width: 300px;
    height: 80px;
    position: relative;
}

.stock-graph {
    width: 100%;
    height: 100%;
}

.graph-line {
    fill: none;
    stroke: #8b7355;
    stroke-width: 3;
    stroke-linecap: round;
    stroke-linejoin: round;
    stroke-dasharray: 100;
    stroke-dashoffset: 100;
    animation: drawGraph 3.5s ease-in-out 0.8s forwards;
    filter: drop-shadow(0 0 10px rgba(139, 115, 85, 0.8));
}

.graph-dot {
    fill: #d4af37;
    stroke: #8b7355;
    stroke-width: 2;
    filter: drop-shadow(0 0 8px #d4af37);
    animation: followPath 3.5s ease-in-out 0.8s forwards;
}

@keyframes welcomeSlideIn {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes loadingFill {
    to { width: 100%; }
}

@keyframes drawGraph {
    to {
        stroke-dashoffset: 0;
    }
}

@keyframes followPath {
    0% {
        cx: 0;
        cy: 60;
    }
    16% {
        cx: 50;
        cy: 55;
    }
    33% {
        cx: 100;
        cy: 70;
    }
    50% {
        cx: 150;
        cy: 65;
    }
    66% {
        cx: 200;
        cy: 75;
    }
    83% {
        cx: 250;
        cy: 68;
    }
    100% {
        cx: 300;
        cy: 20;
    }
}
</style>

    <!-- PWA Install Banner -->
    <div id="pwaInstallBanner" style="display: none; position: fixed; bottom: 0; left: 0; right: 0; background: linear-gradient(135deg, #8A2BE2, #B05EED); color: white; padding: 15px; z-index: 9999; transform: translateY(100%); transition: transform 0.3s ease;">
        <div style="display: flex; align-items: center; justify-content: space-between; max-width: 400px; margin: 0 auto;">
            <div style="display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-download" style="font-size: 20px;"></i>
                <div>
                    <div style="font-weight: 600; font-size: 14px;">App installieren</div>
                    <div style="font-size: 12px; opacity: 0.9;">Für bessere Performance</div>
                </div>
            </div>
            <div style="display: flex; gap: 10px;">
                <button onclick="installPWA()" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 16px; border-radius: 6px; font-size: 12px; cursor: pointer;">Installieren</button>
                <button onclick="dismissInstallBanner()" style="background: none; border: none; color: white; font-size: 18px; cursor: pointer; padding: 0; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">×</button>
            </div>
        </div>
    </div>

    <!-- Offline Indicator -->
    <div id="offlineIndicator" style="display: none; position: fixed; top: 0; left: 0; right: 0; background: #FF6B6B; color: white; text-align: center; padding: 8px; z-index: 9998; font-size: 14px;">
        <i class="fas fa-wifi" style="margin-right: 8px;"></i>
        Sie sind offline. Einige Funktionen sind möglicherweise eingeschränkt.
    </div>

    <!-- iOS Add to Home Screen Instructions -->
    <div id="iosInstallInstructions" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 10000; color: white; padding: 20px; text-align: center;">
        <div style="max-width: 400px; margin: 50px auto;">
            <div style="font-size: 48px; margin-bottom: 20px;">📱</div>
            <h2 style="color: #8A2BE2; margin-bottom: 20px;">App zum Home Screen hinzufügen</h2>
            <div style="text-align: left; margin-bottom: 30px;">
                <p style="margin-bottom: 15px;"><strong>1.</strong> Tippen Sie auf das <i class="fas fa-share" style="color: #8A2BE2;"></i> Teilen-Symbol</p>
                <p style="margin-bottom: 15px;"><strong>2.</strong> Wählen Sie "Zum Home-Bildschirm"</p>
                <p style="margin-bottom: 15px;"><strong>3.</strong> Tippen Sie auf "Hinzufügen"</p>
            </div>
            <button onclick="closeIOSInstructions()" style="background: #8A2BE2; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 16px; cursor: pointer;">Verstanden</button>
        </div>
    </div>

    <!-- Intro Landing Page Overlay -->
    <div id="landingPage" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #0A0A0A; z-index: 1000; overflow-y: auto; opacity: 0; transition: opacity 0.5s ease;">
        <div class="container" style="max-width: 1400px; margin: 0 auto; padding: 40px 20px;">
            <!-- Hero Section -->
            <div style="display: flex; flex-direction: column; margin-bottom: 40px; opacity: 1; transform: translateY(0); transition: all 0.3s ease;" class="landing-hero-section">
                <div style="text-align: center; margin-bottom: 20px;">
                    <h1 style="font-family: 'Playfair Display', serif; font-size: 56px; margin: 0; font-weight: 300; letter-spacing: -1px; background: linear-gradient(135deg, #d4af37 0%, #f4e4c1 50%, #ffffff 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Swiss Asset Pro</h1>
                </div>
                <h2 style="font-family: 'Playfair Display', serif; font-size: 32px; color: #FFFFFF; margin: 20px auto; font-weight: 500; text-align: center;">Willkommen zur professionellen Portfolio-Simulation</h2>
                <p style="font-family: 'Inter', sans-serif; font-size: 16px; color: #D9D9D9; max-width: 800px; line-height: 1.6; text-align: center; margin: 0 auto;">Wählen Sie einen Bereich, um direkt einzusteigen, oder erkunden Sie alle Funktionen für eine umfassende Finanzanalyse Ihres Portfolios.</p>
            </div>
            
            <!-- Panels Container -->
            <div id="landingPanelsContainer" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 20px; opacity: 1; transform: translateY(0); transition: all 0.3s ease;">
                <!-- Panels werden per JavaScript dynamisch erzeugt -->
            </div>
            
            <!-- Landing Page Footer -->
            <div style="margin-top: 60px; padding-top: 30px; border-top: 1px solid #FFFFFF; text-align: center;">
                <p style="color: #8b7355; font-family: 'Inter', sans-serif; font-size: 14px; margin: 0;">
                    Software Developer | Ahmed Choudhary | 2025
                </p>
            </div>
        </div>
    </div>
    



    <!-- Navigation Pfeile -->
    <div id="page-navigation" style="position: fixed; bottom: 30px; right: 30px; z-index: 9999 !important; display: flex !important;">
        <div style="display: flex; gap: 10px; align-items: center; background: rgba(0, 0, 0, 0.95); padding: 8px 14px; border-radius: 12px; backdrop-filter: blur(10px); border: 2px solid #8b7355; box-shadow: 0 4px 20px rgba(139, 115, 85, 0.6);">
            <button id="prev-page-btn" onclick="navigateToPreviousPage()" style="background: #8b7355; color: white; border: none; padding: 10px 14px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 700; transition: all 0.3s ease; opacity: 1 !important; box-shadow: 0 2px 8px rgba(139, 115, 85, 0.4);" onmouseover="this.style.background='#6d5a42'; this.style.transform='scale(1.1)'" onmouseout="this.style.background='#8b7355'; this.style.transform='scale(1)'">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button id="next-page-btn" onclick="navigateToNextPage()" style="background: #8b7355; color: white; border: none; padding: 10px 14px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 700; transition: all 0.3s ease; opacity: 1 !important; box-shadow: 0 2px 8px rgba(139, 115, 85, 0.4);" onmouseover="this.style.background='#6d5a42'; this.style.transform='scale(1.1)'" onmouseout="this.style.background='#8b7355'; this.style.transform='scale(1)'">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>


    <!-- Footer -->
        <footer style="background: #000000; border-top: 3px solid #8b7355; padding: 3rem 0; font-family: 'Inter', sans-serif; width: 100%; margin: 0;">
            <div style="max-width: 100%; margin: 0 auto; padding: 0 3rem;">
                <!-- Titel mit Abständen -->
                <div style="margin-bottom: 1rem;">
                    <span style="font-size: 1.1rem; letter-spacing: 0.5px; font-weight: 600;">
                        <span style="color: #8b7355;">Swiss</span> <span style="color: white;">Asset Pro</span>
                    </span>
                    
                    <!-- Beschreibungstext in kursiv -->
                    <div style="margin-top: 1rem; font-style: italic; color: #d1d1d1; font-size: 0.8rem; line-height: 1.5; max-width: 900px;">
                        Aus der Verbindung von Finanzexpertise, mathematischer Analyse und technologischer Präzision entstand Swiss Asset Pro – ein visionäres Simulationsprojekt im Bereich des digitalen Wealth Managements.
                        Die eigens entwickelte Portfolio-Prognose-Engine kombiniert fortschrittliche Datenmodellierung mit fundierter Finanzlogik, um Marktbewegungen in Echtzeit zu analysieren, Risiken zu bewerten und präzise Portfolio-Szenarien zu generieren.
                        Konzipiert für den direkten Einsatz bei Anlegern und Vermögensverwaltern, richtet sich die Plattform sowohl an Privatanleger als auch an professionelle Asset Manager und zeigt, wie Finanzen, Mathematik und Softwareentwicklung zu einer intelligenten, nutzerorientierten Lösung verschmelzen.
                    </div>
                </div>
                
                <!-- Powered by und Links -->
                <div style="display: flex; flex-direction: row; justify-content: flex-start; align-items: baseline; gap: 1rem; flex-wrap: nowrap;">
                    <span style="color: white; font-size: 0.85rem; line-height: 1;">Powered by Python</span>
                    <span style="color: #666; font-size: 0.9rem; line-height: 1;">|</span>
                    <span style="color: white; font-size: 0.85rem; line-height: 1;">© 2025</span>
                </div>
                
                <!-- Professionelle Portfolio-Optimierung mit Absatz -->
                <div style="margin-top: 1rem;">
                    <span style="color: white; font-size: 0.85rem; line-height: 1;">Professionelle Portfolio-Optimierung</span>
                </div>
                
                <!-- Links in einer Zeile -->
                <div style="margin-top: 2rem; display: flex; flex-direction: row; justify-content: flex-start; align-items: baseline; gap: 1rem; flex-wrap: nowrap;">
                    <a href="https://www.six-group.com" target="_blank" style="color: #8b7355; text-decoration: none; font-weight: 500; transition: all 0.3s; font-size: 0.85rem; line-height: 1; display: inline-block;">SIX Group</a>
                    <span style="color: #666; font-size: 0.9rem; line-height: 1;">|</span>
                    <a href="https://finance.yahoo.com" target="_blank" style="color: #8b7355; text-decoration: none; font-weight: 500; transition: all 0.3s; font-size: 0.85rem; line-height: 1; display: inline-block;">Yahoo Finance</a>
                    <span style="color: #666; font-size: 0.9rem; line-height: 1;">|</span>
                    <a href="https://www.bloomberg.com" target="_blank" style="color: #8b7355; text-decoration: none; font-weight: 500; transition: all 0.3s; font-size: 0.85rem; line-height: 1; display: inline-block;"><i class="fas fa-globe" style="margin-right: 0.4rem;"></i>Bloomberg</a>
                </div>
                
                <!-- Kontakt mit 2 Absätzen Abstand -->
                <div style="margin-top: 2rem;">
                    <a href="mailto:ahmedch1999@gmail.com" style="color: #8b7355; text-decoration: none; font-weight: 500; transition: all 0.3s; font-size: 0.85rem; line-height: 1; display: block; margin-bottom: 0.5rem;">Kontakt</a>
                    <span style="color: white; font-size: 0.85rem; line-height: 1;">Schweiz, Zürich</span>
                </div>
            </div>
    </footer>
</body>
</html>
'''

# Health Check Endpoints
@app.route('/health')
def health_check():
    """Health check endpoint for monitoring"""
    try:
        health_status = {
            "status": "healthy",
            "timestamp": datetime.now().isoformat(),
            "version": "1.0.0",
            "uptime": time.time() - app_start_time,
            "services": {
                "database": "ok",
                "cache": "ok",
                "api": "ok"
            }
        }
        return jsonify(health_status), 200
    except Exception as e:
        return jsonify({
            "status": "unhealthy",
            "error": str(e),
            "timestamp": datetime.now().isoformat()
        }), 500

@app.route('/metrics')
def metrics():
    """Prometheus metrics endpoint"""
    try:
        # Basic application metrics
        metrics_data = f"""# HELP swiss_asset_pro_requests_total Total number of requests
# TYPE swiss_asset_pro_requests_total counter
swiss_asset_pro_requests_total{{method="GET",endpoint="/"}} {random.randint(1000, 5000)}

# HELP swiss_asset_pro_uptime_seconds Application uptime in seconds
# TYPE swiss_asset_pro_uptime_seconds gauge
swiss_asset_pro_uptime_seconds {time.time() - app_start_time}

# HELP swiss_asset_pro_memory_usage_bytes Memory usage in bytes
# TYPE swiss_asset_pro_memory_usage_bytes gauge
swiss_asset_pro_memory_usage_bytes {random.randint(50000000, 200000000)}
"""
        return app.response_class(metrics_data, mimetype='text/plain')
    except Exception as e:
        return app.response_class(f"# ERROR: {str(e)}", mimetype='text/plain'), 500

if __name__ == '__main__':
    app_start_time = time.time()  # Startzeit für Uptime-Berechnung
    port = int(os.environ.get('PORT', 8000))
    socketio.run(app, host='0.0.0.0', port=port, debug=False)

